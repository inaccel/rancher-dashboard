(self["webpackChunkdashboard"]=self["webpackChunkdashboard"]||[]).push([[2055],{5106:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n});var o=s(45522),a=s.n(o),l=s(67643),r=s.n(l),i=r()(a());i.push([e.id,".advanced[data-v-6b03a558]{-webkit-user-select:none;-moz-user-select:none;user-select:none;padding:0 5px;line-height:40px;font-size:15px;font-weight:500}.content[data-v-6b03a558]{background:var(--nav-active);padding:10px;margin-top:6px;border-radius:4px}.locale-chooser[data-v-6b03a558]{cursor:pointer}.locale-chooser[data-v-6b03a558]:hover{text-decoration:none}",""]);const n=i},13942:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n});var o=s(45522),a=s.n(o),l=s(67643),r=s.n(l),i=r()(a());i.push([e.id,".login[data-v-9a9af124]{overflow:hidden}.login .row[data-v-9a9af124]{align-items:center}.login .landscape[data-v-9a9af124]{height:100vh;margin:0;-o-object-fit:cover;object-fit:cover}.login .login-welcome[data-v-9a9af124]{margin:0}.login .login-messages[data-v-9a9af124]{display:flex;justify-content:center;align-items:center}.login .login-messages .banner[data-v-9a9af124]{margin:5px}.login .login-messages h4[data-v-9a9af124]{margin:0}.login .login-messages--hasContent[data-v-9a9af124]{min-height:70px}.login .login-messages .banner[data-v-9a9af124],.login .login-messages .text-error[data-v-9a9af124]{max-width:80%}.login .first-login-message .banner[data-v-9a9af124]{margin-bottom:0;border-left:0}.login .first-login-message .banner[data-v-9a9af124]  code{font-size:12px;padding:0}.gutless[data-v-9a9af124]{height:100vh}.gutless>.span-6[data-v-9a9af124]{overflow-y:auto;display:flex;flex-direction:column;height:100%;place-content:center}.locale-selector[data-v-9a9af124]{position:absolute;bottom:30px}",""]);const n=i},15463:(e,t,s)=>{"use strict";s.d(t,{Bf:()=>h,HK:()=>u,zY:()=>d});var o=s(45848),a=s(25783);const l="bannerHeader",r="bannerFooter",i="bannerConsent",n={"ui-banner-header":l,"ui-banner-footer":r,"ui-banner-login-consent":i},c={[l]:"showHeader",[r]:"showFooter",[i]:"showConsent"};function d(e){const t={},s=e.getters["management/all"](o.Mc.SETTING);return s.forEach((e=>{if(e.value&&n[e.id]){const s=n[e.id];t[s]=e}})),t}function u(e,t){Object.keys(t).forEach((s=>{try{const o=JSON.parse(t[s].value),a=c[s];e[s]=o,e[a]="true"}catch{}}))}function g(e,t=14){const s=2*parseInt(e),o=s/t;return`${o}em`}function h(e){const t=e.getters["management/all"](o.Mc.SETTING),s=t?.find((e=>e.id===a.HG.BANNERS)),l=d(e);if(s){const e=JSON.parse(s.value);u(e,l);const{showFooter:t,showHeader:o,bannerFooter:a,bannerHeader:r,banner:i}=e,n=r?.fontSize||i?.fontSize||"14px",c=a?.fontSize||i?.fontSize||"14px";return{headerFont:"true"===o?g(n):"0px",footerFont:"true"===t?g(c):"0px"}}}},72866:(e,t,s)=>{"use strict";s.d(t,{A:()=>b});var o=s(20641),a=s(90033);const l=e=>((0,o.Qi)("data-v-6b03a558"),e=e(),(0,o.jt)(),e),r={key:0},i={key:0},n={"data-testid":"locale-selector",class:"locale-chooser"},c=l((()=>(0,o.Lk)("i",{class:"icon icon-fw icon-sort-down"},null,-1))),d={class:"list-unstyled dropdown",style:{margin:"-1px"}},u=["onClick"],g={key:1};function h(e,t,s,l,h,p){const m=(0,o.g2)("v-dropdown"),v=(0,o.g2)("Select"),f=(0,o.gN)("t");return(0,o.uX)(),(0,o.CE)("div",null,["login"===s.mode?((0,o.uX)(),(0,o.CE)("div",r,[p.showLocale?((0,o.uX)(),(0,o.CE)("div",i,[(0,o.bF)(m,{popperClass:"localeSelector",placement:"top",distance:"8",skidding:"12",triggers:["click"]},{popper:(0,o.k6)((()=>[(0,o.Lk)("ul",d,[p.showNone?(0,o.bo)(((0,o.uX)(),(0,o.CE)("li",{key:0,class:"hand",onClick:t[0]||(t[0]=e=>p.switchLocale("none"))},null,512)),[[f,"locale.none"]]):(0,o.Q3)("",!0),(0,o.eW)(),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.availableLocales,((e,t)=>((0,o.uX)(),(0,o.CE)("li",{key:t,class:"hand",onClick:e=>p.switchLocale(t)},(0,a.toDisplayString)(e),9,u)))),128))])])),default:(0,o.k6)((()=>[(0,o.Lk)("a",n,[(0,o.eW)((0,a.toDisplayString)(e.selectedLocaleLabel)+" ",1),c]),(0,o.eW)()])),_:1})])):(0,o.Q3)("",!0)])):((0,o.uX)(),(0,o.CE)("div",g,[(0,o.bF)(v,{value:p.selectedOption,options:p.localesOptions,"onUpdate:value":t[1]||(t[1]=e=>p.switchLocale(e))},null,8,["value","options"])]))])}var p=s(66278),m=s(30362);const v={name:"LocalSelector",components:{Select:m.A},props:{mode:{type:String,default:""}},computed:{...(0,p.L8)("i18n",["selectedLocaleLabel","availableLocales"]),localesOptions(){return Object.keys(this.availableLocales).map((e=>({label:this.t(`locale.${e}`),value:e})))},selectedOption(){return Object.keys(this.availableLocales)[Object.values(this.availableLocales).indexOf(this.selectedLocaleLabel)]},showLocale(){return this.availableLocales&&Object.keys(this.availableLocales).length>1||this.dev},showNone(){return!1}},methods:{switchLocale(e){this.$store.dispatch("i18n/switchTo",e)}}};s(69684);var f=s(66262);const L=(0,f.A)(v,[["render",h],["__scopeId","data-v-6b03a558"]]),b=L},22055:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>te});var o=s(20641),a=s(90033),l=s(53751);const r=e=>((0,o.Qi)("data-v-9a9af124"),e=e(),(0,o.jt)(),e),i={key:1,class:"main-layout login"},n={class:"row gutless mb-20"},c={class:"col span-6 p-20"},d={class:"text-center"},u={class:"text-center login-welcome"},g={key:1,class:"text-success text-center"},h={key:2,class:"text-error text-center"},p=r((()=>(0,o.Lk)("u",null,"container-id",-1))),m=r((()=>(0,o.Lk)("br",null,null,-1))),v=r((()=>(0,o.Lk)("br",null,null,-1))),f=r((()=>(0,o.Lk)("br",null,null,-1))),L={class:"span-6 offset-3"},b={class:"mb-20"},k={class:""},w={class:"mt-20"},y={class:"col span-12 text-center"},S={key:0,class:"mt-20"},E={key:1,class:"mt-20 text-center"},C={key:2,class:"mt-20 text-center"},$={key:3,class:"locale-selector"};function x(e,t,s,r,x,I){const O=(0,o.g2)("Loading"),N=(0,o.g2)("Banner"),F=(0,o.g2)("t"),W=(0,o.g2)("CopyCode"),T=(0,o.g2)("LabeledInput"),G=(0,o.g2)("Password"),M=(0,o.g2)("AsyncButton"),P=(0,o.g2)("Checkbox"),A=(0,o.g2)("LocaleSelector"),X=(0,o.g2)("BrandImage");return e.$fetchState.pending?((0,o.uX)(),(0,o.Wv)(O,{key:0,mode:"relative"})):((0,o.uX)(),(0,o.CE)("main",i,[(0,o.Lk)("div",n,[(0,o.Lk)("div",c,[(0,o.Lk)("p",d,(0,a.toDisplayString)(e.t("login.howdy")),1),(0,o.eW)(),(0,o.Lk)("h1",u,(0,a.toDisplayString)(e.t("login.welcome",{vendor:x.vendor})),1),(0,o.eW)(),(0,o.Lk)("div",{class:(0,a.normalizeClass)(["login-messages",{"login-messages--hasContent":I.hasLoginMessage}]),"data-testid":"login__messages"},[I.errorToDisplay?((0,o.uX)(),(0,o.Wv)(N,{key:0,label:I.errorToDisplay,color:"error"},null,8,["label"])):x.loggedOut?((0,o.uX)(),(0,o.CE)("h4",g,(0,a.toDisplayString)(I.loggedOutSuccessMsg),1)):x.timedOut?((0,o.uX)(),(0,o.CE)("h4",h,(0,a.toDisplayString)(e.t("login.loginAgain")),1)):(0,o.Q3)("",!0)],2),(0,o.eW)(),x.firstLogin?((0,o.uX)(),(0,o.CE)("div",{key:0,class:(0,a.normalizeClass)(["first-login-message pl-10 pr-10",{"mt-30":!I.hasLoginMessage}]),"data-testid":"first-login-message"},[(0,o.bF)(F,{k:"setup.defaultPassword.intro",raw:!0}),(0,o.eW)(),(0,o.Lk)("div",null,[(0,o.bF)(F,{k:"setup.defaultPassword.dockerPrefix",raw:!0})]),(0,o.eW)(),(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,[(0,o.bF)(F,{k:"setup.defaultPassword.dockerPs",raw:!0})]),(0,o.eW)(),(0,o.Lk)("li",null,[(0,o.bF)(W,null,{default:(0,o.k6)((()=>[(0,o.eW)("\n                docker logs "),p,(0,o.eW)(' 2>&1 | grep "Bootstrap Password:"\n              ')])),_:1})])]),(0,o.eW)(),(0,o.Lk)("div",null,[(0,o.bF)(F,{k:"setup.defaultPassword.dockerSuffix",raw:!0})]),(0,o.eW)(),m,(0,o.eW)(),(0,o.Lk)("div",null,[(0,o.bF)(F,{k:"setup.defaultPassword.helmPrefix",raw:!0})]),(0,o.eW)(),v,(0,o.eW)(),(0,o.bF)(W,null,{default:(0,o.k6)((()=>[(0,o.eW)((0,a.toDisplayString)(I.kubectlCmd),1)])),_:1}),(0,o.eW)(),f,(0,o.eW)(),(0,o.Lk)("div",null,[(0,o.bF)(F,{k:"setup.defaultPassword.helmSuffix",raw:!0})])],2)):(0,o.Q3)("",!0),(0,o.eW)(),(!x.hasLocal||x.hasLocal&&!x.showLocal)&&x.providers.length?((0,o.uX)(),(0,o.CE)("div",{key:1,class:(0,a.normalizeClass)({"mt-30":!I.hasLoginMessage})},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(x.providers,((e,s)=>((0,o.uX)(),(0,o.Wv)((0,o.$y)(x.providerComponents[s]),{key:s,class:"mb-10","focus-on-mount":0===s&&!x.showLocal,name:e,open:!x.showLocal,onShowInputs:t[0]||(t[0]=e=>x.showLocal=!1),onError:I.handleProviderError},null,40,["focus-on-mount","name","open","onError"])))),128))],2)):(0,o.Q3)("",!0),(0,o.eW)(),x.hasLocal?((0,o.uX)(),(0,o.CE)(o.FK,{key:2},[x.showLocal?((0,o.uX)(),(0,o.CE)("form",{key:0,class:(0,a.normalizeClass)({"mt-30":!I.hasLoginMessage}),onSubmit:t[4]||(t[4]=(0,l.withModifiers)((()=>{}),["prevent"]))},[(0,o.Lk)("div",L,[(0,o.Lk)("div",b,[x.firstLogin?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.Wv)(T,{key:0,id:"username",ref:"username",value:x.username,"onUpdate:value":t[1]||(t[1]=e=>x.username=e),valueModifiers:{trim:!0},"data-testid":"local-login-username",label:e.t("login.username"),autocomplete:"username"},null,8,["value","label"]))]),(0,o.eW)(),(0,o.Lk)("div",k,[(0,o.bF)(G,{id:"password",ref:"password",value:x.password,"onUpdate:value":t[2]||(t[2]=e=>x.password=e),"data-testid":"local-login-password",label:e.t("login.password"),autocomplete:"password"},null,8,["value","label"])])]),(0,o.eW)(),(0,o.Lk)("div",w,[(0,o.Lk)("div",y,[(0,o.bF)(M,{id:"submit","data-testid":"login-submit",type:"submit","action-label":e.t("login.loginWithLocal"),"waiting-label":e.t("login.loggingIn"),"success-label":e.t("login.loggedIn"),"error-label":e.t("asyncButton.default.error"),onClick:I.loginLocal},null,8,["action-label","waiting-label","success-label","error-label","onClick"]),(0,o.eW)(),x.firstLogin?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("div",S,[(0,o.bF)(P,{value:x.remember,"onUpdate:value":t[3]||(t[3]=e=>x.remember=e),label:e.t("login.remember.label"),type:"checkbox"},null,8,["value","label"])]))])])],34)):(0,o.Q3)("",!0),(0,o.eW)(),x.hasLocal&&!x.showLocal?((0,o.uX)(),(0,o.CE)("div",E,[(0,o.Lk)("a",{id:"login-useLocal","data-testid":"login-useLocal",role:"button",onClick:t[5]||(t[5]=(...e)=>I.toggleLocal&&I.toggleLocal(...e))},(0,a.toDisplayString)(e.t("login.useLocal")),1)])):(0,o.Q3)("",!0),(0,o.eW)(),x.hasLocal&&x.showLocal&&x.providers.length?((0,o.uX)(),(0,o.CE)("div",C,[(0,o.Lk)("a",{role:"button",onClick:t[6]||(t[6]=(...e)=>I.toggleLocal&&I.toggleLocal(...e))},(0,a.toDisplayString)(I.nonLocalPrompt),1)])):(0,o.Q3)("",!0)],64)):(0,o.Q3)("",!0),(0,o.eW)(),x.showLocaleSelector?((0,o.uX)(),(0,o.CE)("div",$,[(0,o.bF)(A,{style:(0,a.normalizeStyle)(I.localeSelectorStyle),mode:"login"},null,8,["style"])])):(0,o.Q3)("",!0)]),(0,o.eW)(),(0,o.bF)(X,{class:"col span-6 landscape","data-testid":"login-landscape__img","file-name":"login-landscape.svg"})])]))}var I=s(26358),O=s(39370),N=s(76773),F=s(17793),W=s(72866),T=s(86865),G=s(71096),M=s(87645),P=s(17899),A=s(77444),X=s(73317),_=s(62321),Q=s(7958),R=s(47293),H=s(66278),B=s(37676),D=s(35689),z=s(45848),j=s(25783),U=s(58424),q=s(93133),J=s(27150),K=s(45016),V=s(15463);const Z={name:"Login",components:{LabeledInput:N.o,AsyncButton:F.A,Checkbox:X.S,BrandImage:T.A,Banner:P.l,InfoBox:G.A,CopyCode:M.A,Password:_.A,LocaleSelector:W.A,Loading:K.A},data(){const e=this.$cookies.get(O.HF,{parseJSON:!1})||"";return{username:e,remember:!!e,password:"",timedOut:this.$route.query[A.VP]===A.Qp,loggedOut:this.$route.query[A.gZ]===A.Qp,isSsoLogout:this.$route.query[A.r3]===A.Qp,isSlo:this.$route.query[A.kM]===A.Qp,err:this.$route.query.err,showLocaleSelector:!0,hasLocal:!1,showLocal:!1,providers:[],providerComponents:[],customLoginError:{},firstLogin:!1,vendor:(0,q.f7)()}},computed:{...(0,H.L8)({t:"i18n/t"}),loggedOutSuccessMsg(){return this.isSlo?this.t("login.loggedOutFromSlo"):this.isSsoLogout?this.t("login.loggedOutFromSso"):this.t("login.loggedOut")},singleProvider(){return 1===this.providers.length?this.providers[0]:void 0},nonLocalPrompt(){if(this.singleProvider){const e=this.displayName(this.singleProvider);return this.t("login.useProvider",{provider:e})}return this.t("login.useNonLocal")},errorMessage(){return this.isSlo?this.err?.length?this.t("logout.error",{msg:this.err}):"":this.err===U.LOGIN_ERRORS.CLIENT_UNAUTHORIZED?this.t("login.clientError"):this.err===U.LOGIN_ERRORS.CLIENT||this.err===U.LOGIN_ERRORS.SERVER?this.t("login.error"):this.err?.length?this.t("login.specificError",{msg:this.err}):""},errorToDisplay(){return"true"===this.customLoginError?.showMessage&&this.customLoginError?.message&&this.errorMessage?`${this.customLoginError.message} \n ${this.errorMessage}`:this.errorMessage?this.errorMessage:""},kubectlCmd(){return"kubectl get secret --namespace cattle-system bootstrap-secret -o go-template='{{.data.bootstrapPassword|base64decode}}{{\"\\n\"}}'"},hasLoginMessage(){return this.errorToDisplay||this.loggedOut||this.timedOut},localeSelectorStyle(){const e=(0,V.Bf)(this.$store);return{marginBottom:e?.footerFont}}},async fetch(){const{firstLoginSetting:e}=await this.loadInitialSettings(),{value:t}=await this.$store.dispatch("management/find",{type:z.Mc.SETTING,id:j.HG.BANNERS}),s=await this.$store.dispatch("auth/getAuthProviders"),o=(0,Q.Ul)(s.map((e=>e.id)),["id"]),a=o.includes("local"),l=a&&!!o.find((e=>"local"!==e));a&&(0,I.Gj)(o,"local"),this.vendor=(0,q.f7)(),this.providers=o,this.hasLocal=a,this.showLocal=!l||this.$route.query[A.G8]===A.Qp,this.customLoginError=JSON.parse(t).loginError,this.firstLogin="true"===e?.value,this.username=this.firstLogin?"admin":this.username,this.providerComponents=this.providers.map((e=>(0,B.IG)(this.$store.getters["type-map/importLogin"](R.configType[e]||e)))),this.$nextTick((()=>{this.focusSomething()}))},methods:{async loadInitialSettings(){let e,t,s;try{e=this.$store.getters["management/byId"](z.Mc.SETTING,j.HG.FIRST_LOGIN),t=this.$store.getters["management/byId"](z.Mc.SETTING,j.HG.PL),s=this.$store.getters["management/byId"](z.Mc.SETTING,j.HG.BRAND)}catch(o){e=await this.$store.dispatch("rancher/find",{type:z.k$.SETTING,id:j.HG.FIRST_LOGIN,opt:{url:`/v3/settings/${j.HG.FIRST_LOGIN}`}}),t=await this.$store.dispatch("rancher/find",{type:z.k$.SETTING,id:j.HG.PL,opt:{url:`/v3/settings/${j.HG.PL}`}}),s=await this.$store.dispatch("rancher/find",{type:z.k$.SETTING,id:j.HG.BRAND,opt:{url:`/v3/settings/${j.HG.BRAND}`}})}return t.value?.length&&t.value!==(0,q.f7)()&&(0,q.xc)(t.value),s?.value?.length&&s.value!==(0,q.o7)()&&(0,q.aA)(s.value),{firstLoginSetting:e,plSetting:t,brand:s}},displayName(e){return this.t(`model.authConfig.provider.${e}`)},toggleLocal(){this.showLocal=!this.showLocal,this.$router.applyQuery({[A.G8]:A.Qp}),this.$nextTick((()=>{this.focusSomething()}))},focusSomething(){if(!this.showLocal)return;let e;e=this.username?this.$refs.password:this.$refs.username,e?.focus&&(e.focus(),e.select&&e.select())},handleProviderError(e){this.err=e},async loginLocal(e){try{await this.$store.dispatch("auth/login",{provider:"local",body:{username:this.username,password:this.password}});const e=await this.$store.dispatch("rancher/findAll",{type:z.k$.USER,opt:{url:"/v3/users?me=true",load:D.lh}});e?.[0]&&this.$store.dispatch("auth/gotUser",e[0]),this.remember?this.$cookies.set(O.HF,this.username,{encode:e=>e,maxAge:31536e3,path:"/",sameSite:!0,secure:!0}):this.$cookies.remove(O.HF),await(0,J.A)({app:this.$store.app,store:this.$store,$plugin:this.$store.$plugin}),this.firstLogin||e[0]?.mustChangePassword?(this.$store.dispatch("auth/setInitialPass",this.password),this.$router.push({name:"auth-setup"})):this.$router.push({name:"index"})}catch(t){this.err=t,this.timedOut=null,this.loggedOut=null,e(!1)}}}};s(32216);var Y=s(66262);const ee=(0,Y.A)(Z,[["render",x],["__scopeId","data-v-9a9af124"]]),te=ee},69684:(e,t,s)=>{var o=s(5106);o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[e.id,o,""]]),o.locals&&(e.exports=o.locals);var a=s(99548).A;a("268543ff",o,!0,{sourceMap:!1,shadowMode:!1})},32216:(e,t,s)=>{var o=s(13942);o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[e.id,o,""]]),o.locals&&(e.exports=o.locals);var a=s(99548).A;a("ecf91f48",o,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=2055.c42771ec.js.map