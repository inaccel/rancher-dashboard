(self["webpackChunkdashboard"]=self["webpackChunkdashboard"]||[]).push([[352],{38081:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var a=r(45522),s=r.n(a),o=r(67643),l=r.n(o),n=l()(s());n.push([e.id,".role[data-v-005ac0af]{align-items:center;background-color:rgba(0,0,0,.05);border:1px solid var(--header-border);border-radius:5px;color:var(--tag-text);line-height:20px;padding:2px 5px;white-space:nowrap;display:inline-flex;margin-right:3px}.role-value.text-link-enabled[data-v-005ac0af]{cursor:pointer}.role-value.text-link-enabled[data-v-005ac0af]:hover{color:var(--primary)}.role-value+.icon-close[data-v-005ac0af]{margin-left:3px;cursor:pointer}.role-value+.icon-close[data-v-005ac0af]:hover{color:var(--primary)}.project-members[data-v-005ac0af]  .group-bar{display:flex;justify-content:space-between}.cluster-add[data-v-005ac0af]{justify-content:flex-end}",""]);const c=n},80352:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>x});var a=r(20641),s=r(90033);function o(e,t,r,o,l,n){const c=(0,a.g2)("ExplorerMembers");return(0,a.uX)(),(0,a.Wv)(c,(0,s.normalizeProps)((0,a.Ng)(e.$attrs)),null,16)}const l={class:"project-members"},n={key:0,class:"row mb-10 cluster-add"},c={class:"group-bar"},i={class:"group-tab"},d={class:"project-name"},p={class:"right"},u=["onClick"],m=["data-testid"],h=["onClick"],g=["data-testid","onClick"],b={class:"main-row"},T={class:"empty text-center",colspan:"100%"};function R(e,t,r,o,R,j){const f=(0,a.g2)("Masthead"),P=(0,a.g2)("Banner"),E=(0,a.g2)("router-link"),v=(0,a.g2)("ResourceTable"),L=(0,a.g2)("Tab"),C=(0,a.g2)("SortableTable"),y=(0,a.g2)("Tabbed"),I=(0,a.gN)("clean-html"),M=(0,a.gN)("trim-whitespace");return(0,a.uX)(),(0,a.CE)("div",l,[(0,a.bF)(f,{schema:R.schema,resource:R.resource,"favorite-resource":R.VIRTUAL_TYPES.CLUSTER_MEMBERS,"create-location":R.createLocation,"create-button-label":e.t("members.createActionLabel"),"is-creatable":!1,"type-display":e.t("members.clusterAndProject")},null,8,["schema","resource","favorite-resource","create-location","create-button-label","type-display"]),(0,a.eW)(),j.isLocal?((0,a.uX)(),(0,a.Wv)(P,{key:0,color:"error",label:e.t("members.localClusterWarning")},null,8,["label"])):(0,a.Q3)("",!0),(0,a.eW)(),(0,a.bF)(y,null,{default:(0,a.k6)((()=>[(0,a.bF)(L,{name:"cluster-membership",label:e.t("members.clusterMembership")},{default:(0,a.k6)((()=>[j.canEditClusterMembers?((0,a.uX)(),(0,a.CE)("div",n,[(0,a.bF)(E,{to:R.createLocation,class:"btn role-primary pull-right"},{default:(0,a.k6)((()=>[(0,a.eW)((0,s.toDisplayString)(e.t("members.createActionLabel")),1)])),_:1},8,["to"])])):(0,a.Q3)("",!0),(0,a.eW)(),(0,a.bF)(v,{schema:R.schema,headers:R.headers,rows:j.filteredClusterRoleTemplateBindings,groupable:!0,"show-grouping":!0,namespaced:!1,loading:e.$fetchState.pending||!e.currentCluster||R.loadingClusterBindings,"sub-search":"subSearch","sub-fields":["nameDisplay"]},null,8,["schema","headers","rows","loading"])])),_:1},8,["label"]),(0,a.eW)(),j.canManageProjectMembers?((0,a.uX)(),(0,a.Wv)(L,{key:0,name:"project-membership",label:e.t("members.projectMembership")},{default:(0,a.k6)((()=>[(0,a.bF)(C,{"group-by":"projectId",loading:e.$fetchState.pending||!e.currentCluster||R.loadingProjectBindings,rows:j.rowsWithFakeProjects,headers:R.projectRoleTemplateColumns,"table-actions":!1,"row-actions":!1},(0,a.eX)({"group-by":(0,a.k6)((t=>[(0,a.Lk)("div",c,[(0,a.bo)(((0,a.uX)(),(0,a.CE)("div",i,[(0,a.bo)((0,a.Lk)("div",d,null,512),[[I,j.getProjectLabel(t)]])])),[[M]]),(0,a.eW)(),(0,a.Lk)("div",p,[j.canEditProjectMembers?((0,a.uX)(),(0,a.CE)("button",{key:0,type:"button",class:"create-namespace btn btn-sm role-secondary mr-10 right",onClick:e=>j.addProjectMember(t)},(0,s.toDisplayString)(e.t("members.createActionLabel")),9,u)):(0,a.Q3)("",!0)])])])),"cell:role":(0,a.k6)((({row:e})=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.allRoles,((t,r)=>((0,a.uX)(),(0,a.CE)("span",{key:r,ref_for:!0,ref:"value","data-testid":`role-value-${r}`,class:"role"},[(0,a.Lk)("span",{class:(0,s.normalizeClass)(["role-value",{"text-link-enabled":e.canViewInApi}]),onClick:r=>j.viewRoleInAPI(e,t)},(0,s.toDisplayString)(t.nameDisplay),11,h),(0,a.eW)(),(0,a.Lk)("i",{class:"icon icon-close","data-testid":`role-values-close-${r}`,onClick:r=>j.removeRole(e,t,r)},null,8,g)],8,m)))),128))])),_:2},[(0,a.pI)(j.projectsWithoutRoles,((t,r)=>({name:j.slotName(t),fn:(0,a.k6)((()=>[(0,a.Lk)("tr",b,[(0,a.Lk)("td",T,(0,s.toDisplayString)(e.t("members.noRolesAssigned")),1)])]))})))]),1032,["loading","rows","headers"])])),_:1},8,["label"])):(0,a.Q3)("",!0)])),_:1})])}var j=r(45848),f=r(2803),P=r(24718),E=r(53806),v=r(20836),L=r(15203),C=r(22415),y=r(70546),I=r(80112),M=r(66278),k=r(33194),A=r(57735);const B={name:"ExplorerMembers",components:{Banner:L.A,Masthead:P.A,ResourceTable:f.A,Tabbed:C.A,Tab:y.A,SortableTable:I.A},props:{createLocationOverride:{type:Object,default:()=>({name:"c-cluster-product-resource-create",params:{resource:j.Mc.CLUSTER_ROLE_TEMPLATE_BINDING}})}},async fetch(){const e=this.$store.getters["rancher/schemaFor"](j.k$.CLUSTER_ROLE_TEMPLATE_BINDING),t=this.$store.getters["rancher/schemaFor"](j.k$.PROJECT_ROLE_TEMPLATE_BINDING);this["normanClusterRTBSchema"]=e,this["normanProjectRTBSchema"]=t,e&&Promise.all([this.$store.dispatch("rancher/findAll",{type:j.k$.CLUSTER_ROLE_TEMPLATE_BINDING},{root:!0}),this.$store.dispatch("management/findAll",{type:j.Mc.CLUSTER_ROLE_TEMPLATE_BINDING})]).then((([e])=>{this["normanClusterRoleTemplateBindings"]=e,this.loadingClusterBindings=!1})),t&&this.$store.dispatch("rancher/findAll",{type:j.k$.PROJECT_ROLE_TEMPLATE_BINDING},{root:!0}).then((e=>{this["projectRoleTemplateBindings"]=e,this.loadingProjectBindings=!1})),this.$store.dispatch("management/findAll",{type:j.Mc.PROJECT}).then((e=>this["projects"]=e));const r={normanPrincipals:this.$store.dispatch("rancher/findAll",{type:j.k$.PRINCIPAL}),mgmt:this.$store.dispatch("management/findAll",{type:j.Mc.USER}),mgmtRoleTemplates:this.$store.dispatch("management/findAll",{type:j.Mc.ROLE_TEMPLATE})};await(0,A.kR)(r)},data(){return{schema:this.$store.getters["management/schemaFor"](j.Mc.CLUSTER_ROLE_TEMPLATE_BINDING),headers:[E.c4,E.nv,E.z7,E.K],createLocation:{...this.createLocationOverride,params:{...this.createLocationOverride.params,cluster:this.$store.getters["currentCluster"].id}},resource:j.Mc.CLUSTER_ROLE_TEMPLATE_BINDING,normanClusterRTBSchema:null,normanProjectRTBSchema:null,normanClusterRoleTemplateBindings:[],projectRoleTemplateBindings:[],projects:[],VIRTUAL_TYPES:j.cG,projectRoleTemplateColumns:[E.c4,{name:"member",labeKey:"generic.name",value:"principalId",formatter:"Principal"},{name:"role",labelKey:"tableHeaders.role",value:"roleTemplate.nameDisplay"}],loadingProjectBindings:!0,loadingClusterBindings:!0}},computed:{...(0,M.L8)(["currentCluster"]),clusterRoleTemplateBindings(){return this.normanClusterRoleTemplateBindings.map((e=>e.clusterroletemplatebinding))},filteredClusterRoleTemplateBindings(){return this.clusterRoleTemplateBindings.filter((e=>e?.clusterName===this.$store.getters["currentCluster"].id))},filteredProjects(){return this.projects.reduce(((e,t)=>(t?.spec?.clusterName===this.currentCluster.id&&(e[t.id]=t),e)),{})},filteredProjectRoleTemplateBindings(){const e=this.projectRoleTemplateBindings.filter((e=>{const t=e.projectId.replace(":","/");return!!this.filteredProjects[t]}));return e},projectsWithoutRoles(){const e=this.filteredProjectRoleTemplateBindings.reduce(((e,t)=>{const r=(t.projectId||"").replace(":","/");return e.includes(r)||e.push(r),e}),[]);return Object.keys(this.filteredProjects).reduce(((t,r)=>{const a=this.filteredProjects[r];return e.includes(r)||t.push(a),t}),[])},rowsWithFakeProjects(){const e=this.projectsWithoutRoles.map((e=>({groupByLabel:`resourceTable.groupLabel.notInAProject-${e.id}`,isFake:!0,mainRowKey:e.id,nameDisplay:e.spec?.displayName,project:e,availableActions:[],projectId:e.id}))),t=[...e,...this.filteredProjectRoleTemplateBindings].reduce(((e,t)=>{const{userId:r,groupPrincipalId:a,roleTemplate:s,projectId:o}=t,l=r||a;if(!l)return e;const n=l+o;return e[n]||(e[n]=t,e[n].allRoles=[]),s&&e[n].allRoles.push(t.roleTemplate),e}),{});return Object.values(t)},canManageMembers(){return(0,v.J)(this.$store)},canManageProjectMembers(){return(0,k.A)(this.$store)},isLocal(){return this.$store.getters["currentCluster"].isLocal},canEditProjectMembers(){return this.normanProjectRTBSchema?.collectionMethods.find((e=>"post"===e.toLowerCase()))},canEditClusterMembers(){return this.normanClusterRTBSchema?.collectionMethods.find((e=>"post"===e.toLowerCase()))}},methods:{getMgmtProjectId(e){return e.group.key.replace(":","/")},getMgmtProject(e){return this.$store.getters["management/byId"](j.Mc.PROJECT,this.getMgmtProjectId(e))},getProjectLabel(e){return this.getMgmtProject(e)?.spec?.displayName},addProjectMember(e){this.$store.dispatch("cluster/promptModal",{component:"AddProjectMemberDialog",componentProps:{projectId:e.group.key.replace("/",":"),saveInModal:!0},modalSticky:!0})},getProjectRoleBinding(e,t){const r=e.userId?"userId":"groupPrincipalId";return this.projectRoleTemplateBindings.find((a=>a.projectId===e.projectId&&a.roleTemplateId===t.id&&a[r]===e[r]))},async removeRole(e,t,r){const a=this.getProjectRoleBinding(e,t);await a.promptRemove()},viewRoleInAPI(e,t){const r=this.getProjectRoleBinding(e,t);r?.canViewInApi&&r.viewInApi()},slotName(e){return`main-row:${e.id}`}}};r(92131);var _=r(66262);const w=(0,_.A)(B,[["render",R],["__scopeId","data-v-005ac0af"]]),$=w,S={components:{ExplorerMembers:$}},N=(0,_.A)(S,[["render",o]]),x=N},92131:(e,t,r)=>{var a=r(38081);a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);var s=r(99548).A;s("51d79743",a,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=352.1b479cc9.js.map