(self["webpackChunkdashboard"]=self["webpackChunkdashboard"]||[]).push([[3530],{80955:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n});var a=s(45522),r=s.n(a),l=s(67643),o=s.n(l),i=o()(r());i.push([e.id,".principal[data-v-1546955e]{display:block;background:var(--box-bg);border:1px solid var(--border);border-radius:3px;margin:10px 0;padding:10px;line-height:40px}.principal img[data-v-1546955e]{vertical-align:middle;margin:0 10px}.setup[data-v-1546955e]{overflow:hidden}.setup .row .checkbox[data-v-1546955e]{margin:auto}.setup .row .span-6[data-v-1546955e]{padding:0 60px;margin:0}.setup .row .landscape[data-v-1546955e]{height:100vh;margin:0;-o-object-fit:cover;object-fit:cover;padding:0;width:49%}.setup .form-col[data-v-1546955e]{display:flex;flex-direction:column;overflow-y:auto;position:relative;height:100vh;width:51%}.setup .form-col>div[data-v-1546955e]:first-of-type{flex:3}.setup .form-col>div[data-v-1546955e]:nth-of-type(2){flex:9}.setup .setup-title[data-v-1546955e]  code{font-size:12px;padding:0}.setup .setup-errors[data-v-1546955e]{min-height:50px}.setup p[data-v-1546955e]{line-height:20px}",""]);const n=i},23530:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>J});var a=s(20641),r=s(53751),l=s(90033);const o=e=>((0,a.Qi)("data-v-1546955e"),e=e(),(0,a.jt)(),e),i={class:"row"},n={class:"col span-6 form-col"},u=o((()=>(0,a.Lk)("div",null,"\n          Â \n        ",-1))),d={class:"text-center"},p={class:"text-center mb-20 mt-20 setup-title"},c=["value"],h={class:"mb-20"},v={class:"mb-20"},m={class:"addon",style:{padding:"0 0 0 12px"}},g={key:0,class:"mt-20 mb-20"},w={class:"mt-20"},b={class:"checkbox mt-40"},f={class:"checkbox pt-10 eula"},y={id:"submit",class:"text-center mt-20"},k={class:"setup-errors mt-20"};function E(e,t,s,o,E,U){const L=(0,a.g2)("Loading"),x=(0,a.g2)("Password"),C=(0,a.g2)("RadioGroup"),$=(0,a.g2)("CopyToClipboard"),R=(0,a.g2)("LabeledInput"),P=(0,a.g2)("t"),F=(0,a.g2)("Banner"),I=(0,a.g2)("Checkbox"),W=(0,a.g2)("AsyncButton"),G=(0,a.g2)("BrandImage"),S=(0,a.gN)("clean-html");return e.$fetchState.pending?((0,a.uX)(),(0,a.Wv)(L,{key:0,mode:"relative"})):((0,a.uX)(),(0,a.CE)("form",{key:1,class:"setup",onSubmit:t[8]||(t[8]=(0,r.withModifiers)((()=>{}),["prevent"]))},[(0,a.Lk)("div",i,[(0,a.Lk)("div",n,[u,(0,a.eW)(),(0,a.Lk)("div",null,[(0,a.Lk)("h1",d,(0,l.toDisplayString)(e.t("setup.welcome",{product:E.product})),1),(0,a.eW)(),E.mustChangePassword?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[(0,a.bo)((0,a.Lk)("p",p,null,512),[[S,e.t(E.isFirstLogin?"setup.setPassword":"setup.newUserSetPassword",{username:E.username},!0)]]),(0,a.eW)(),E.haveCurrent?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.Wv)(x,{key:0,value:E.current,"onUpdate:value":t[0]||(t[0]=e=>E.current=e),valueModifiers:{trim:!0},autocomplete:"current-password",type:"password",label:e.t("setup.currentPassword"),class:"mb-20",required:!0},null,8,["value","label"])),(0,a.eW)(),(0,a.Lk)("input",{type:"hidden",name:"username",autocomplete:"username",value:E.username},null,8,c),(0,a.eW)(),(0,a.Lk)("div",h,[(0,a.bF)(C,{value:E.useRandom,"onUpdate:value":t[1]||(t[1]=e=>E.useRandom=e),"data-testid":"setup-password-mode",name:"password-mode",options:E.passwordOptions},null,8,["value","options"])]),(0,a.eW)(),(0,a.Lk)("div",v,[E.useRandom?((0,a.uX)(),(0,a.Wv)(R,{key:0,ref:"password",value:E.password,"onUpdate:value":t[2]||(t[2]=e=>E.password=e),valueModifiers:{trim:!0},type:E.useRandom?"text":"password",disabled:E.useRandom,"data-testid":"setup-password-random","label-key":"setup.newPassword"},(0,a.eX)({_:2},[E.useRandom?{name:"suffix",fn:(0,a.k6)((()=>[(0,a.Lk)("div",m,[(0,a.bF)($,{text:E.password,class:"btn-sm"},null,8,["text"])])])),key:"0"}:void 0]),1032,["value","type","disabled"])):((0,a.uX)(),(0,a.Wv)(x,{key:1,ref:"password",value:E.password,"onUpdate:value":t[3]||(t[3]=e=>E.password=e),valueModifiers:{trim:!0},label:e.t("setup.newPassword"),"data-testid":"setup-password",required:!0},null,8,["value","label"]))]),(0,a.eW)(),(0,a.bo)((0,a.bF)(x,{value:E.confirm,"onUpdate:value":t[4]||(t[4]=e=>E.confirm=e),valueModifiers:{trim:!0},autocomplete:"new-password","data-testid":"setup-password-confirm",label:e.t("setup.confirmPassword"),required:!0},null,8,["value","label"]),[[r.vShow,!E.useRandom]])],64)):(0,a.Q3)("",!0),(0,a.eW)(),E.isFirstLogin?((0,a.uX)(),(0,a.CE)(a.FK,{key:1},[E.mcmEnabled?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[E.mustChangePassword?((0,a.uX)(),(0,a.CE)("hr",g)):(0,a.Q3)("",!0),(0,a.eW)(),(0,a.Lk)("p",null,[(0,a.bF)(P,{k:"setup.serverUrl.tip",raw:!0})]),(0,a.eW)(),(0,a.Lk)("div",w,[U.showLocalhostWarning?((0,a.uX)(),(0,a.Wv)(F,{key:0,color:"warning",label:e.t("validation.setting.serverUrl.localhost"),"data-testid":"setup-serverurl-localhost-warning"},null,8,["label"])):(0,a.Q3)("",!0),(0,a.eW)(),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.fvGetPathErrors(["serverUrl"]),((e,t)=>((0,a.uX)(),(0,a.Wv)(F,{key:t,color:"error",label:e,"data-testid":"setup-error-banner"},null,8,["label"])))),128)),(0,a.eW)(),(0,a.bF)(R,{value:E.serverUrl,"onUpdate:value":[t[5]||(t[5]=e=>E.serverUrl=e),U.onServerUrlChange],label:e.t("setup.serverUrl.label"),"data-testid":"setup-server-url",rules:e.fvGetAndReportPathRules("serverUrl"),required:!0},null,8,["value","label","rules","onUpdate:value"])])],64)):(0,a.Q3)("",!0),(0,a.eW)(),(0,a.Lk)("div",b,[(0,a.bF)(I,{id:"checkbox-telemetry",value:E.telemetry,"onUpdate:value":t[6]||(t[6]=e=>E.telemetry=e)},{label:(0,a.k6)((()=>[(0,a.bF)(P,{k:"setup.telemetry",raw:!0,name:E.productName},null,8,["name"])])),_:1},8,["value"])]),(0,a.eW)(),(0,a.Lk)("div",f,[(0,a.bF)(I,{id:"checkbox-eula",value:E.eula,"onUpdate:value":t[7]||(t[7]=e=>E.eula=e),"data-testid":"setup-agreement"},{label:(0,a.k6)((()=>[(0,a.bF)(P,{k:"setup.eula",raw:!0,name:E.productName},null,8,["name"])])),_:1},8,["value"])])],64)):(0,a.Q3)("",!0),(0,a.eW)(),(0,a.Lk)("div",y,[(0,a.bF)(W,{key:"passwordSubmit",type:"submit",mode:"continue",disabled:!U.saveEnabled,"data-testid":"setup-submit",onClick:U.save},null,8,["disabled","onClick"])]),(0,a.eW)(),(0,a.Lk)("div",k,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(E.errors,((e,t)=>((0,a.uX)(),(0,a.CE)("h4",{key:t,class:"text-error text-center"},(0,l.toDisplayString)(e),1)))),128))])])]),(0,a.eW)(),(0,a.bF)(G,{class:"col span-6 landscape","file-name":"login-landscape.svg"})])],32))}var U=s(45363),L=s(76773),x=s(85298),C=s(17793),$=s(77444),R=s(45848),P=s(26358),F=s(73317),I=s(93133),W=s(4207),G=s(76890),S=s(25783),T=s(63360),M=s(95510),A=s(62321),N=s(1677),X=s(86865),_=s(60915),H=s(17899),q=s(45227),O=s(42673),Q=s.n(O),j=s(42694),B=s(45016),K=s(96763);const Z=e=>{const t=e.getters["management/byId"](R.Mc.SETTING,S.HG.FIRST_LOGIN);return"true"===t?.value},D=async e=>{await e.dispatch("auth/getUser");const t=e.getters["auth/v3User"]?.mustChangePassword;return t},z={mixins:[q.A],data(){return{passwordOptions:[{label:this.t("setup.useRandom"),value:!0},{label:this.t("setup.useManual"),value:!1}],fvFormRuleSets:[{path:"serverUrl",rootObject:this,rules:["required","https","url","trailingForwardSlash"]}],productName:"",vendor:(0,I.f7)(),product:(0,I.oo)(),step:parseInt(this.$route.query.step,10)||1,useRandom:!0,haveCurrent:!1,username:null,isFirstLogin:!1,mustChangePassword:!1,current:null,password:(0,U.vx)(),confirm:null,v3User:null,serverUrl:null,mcmEnabled:null,telemetry:null,eula:!1,principals:null,errors:[]}},async beforeCreate(){const e=Z(this.$store),t=await D(this.$store);if(!e){if(t){if(this.$store.getters["auth/initialPass"])return;return await this.$store.dispatch("auth/logout",null,{root:!0}),this.$router.replace(`/auth/login?${$.gZ}`)}return this.$router.replace("/")}},components:{AsyncButton:C.A,LabeledInput:L.o,CopyToClipboard:x.A,Checkbox:F.S,RadioGroup:W.z,Password:A.A,BrandImage:X.A,Banner:H.l,Loading:B.A},async fetch(){const e=this.$store.getters["management/byId"](R.Mc.SETTING,S.HG.TELEMETRY),t=this.$store.getters["management/byId"](R.Mc.SETTING,S.HG.SERVER_URL),s=this.$store.getters["management/byId"](R.Mc.SETTING,S.HG.VERSION_RANCHER);let a,r=!0;e?.value&&"prompt"!==e.value?r="out"!==e.value:s?.value&&!(0,T.W2)(s?.value)||(r=!1);try{a=this.$store.getters["management/byId"](R.Mc.SETTING,S.HG.PL)}catch(m){a=await this.$store.dispatch("rancher/find",{type:R.k$.SETTING,id:S.HG.PL,opt:{url:`/v3/settings/${S.HG.PL}`}})}a.value?.length&&a.value!==(0,I.f7)()&&(0,I.xc)(a.value);const l=a.default,o=await this.$store.dispatch("rancher/findAll",{type:R.k$.PRINCIPAL,opt:{url:"/v3/principals"}}),i=(0,P.jq)(o,"me",!0),n=this.$route.query[$.K1]||this.$store.getters["auth/initialPass"],u=this.$store.getters["auth/v3User"]??{},d=await this.$store.dispatch("management/find",{type:R.Mc.FEATURE,id:"multi-cluster-management",opt:{url:`/v1/${R.Mc.FEATURE}/multi-cluster-management`}}),p=d?.spec?.value||d?.status?.default;let c;c=t?.value?t.value:window.location.origin;const h=await Z(this.$store),v=await D(this.$store);this["productName"]=l,this["haveCurrent"]=!!n,this["username"]=i?.loginName||"admin",this["isFirstLogin"]=h,this["mustChangePassword"]=v,this["current"]=n,this["v3User"]=u,this["serverUrl"]=c,this["mcmEnabled"]=p,this["telemetry"]=r,this["principals"]=o},computed:{saveEnabled(){if(!this.eula&&this.isFirstLogin)return!1;if(this.mustChangePassword){if(!this.current)return!1;if(!this.useRandom&&(!this.password||this.password!==this.confirm))return!1}return!(!Q()(this.serverUrl)||this.fvGetPathErrors(["serverUrl"]).length>0)},me(){const e=(0,P.jq)(this.principals,"me",!0);return e},showLocalhostWarning(){return(0,j.M8)(this.serverUrl)}},watch:{useRandom(e){e?this.password=(0,U.vx)():(this.password="",this.$nextTick((()=>{this.$refs.password.focus()})))}},methods:{async save(e){const t=[];try{await(0,N.applyProducts)(this.$store,this.$plugin),await this.$store.dispatch("loadManagement"),this.mustChangePassword?await this.$store.dispatch("rancher/request",{url:"/v3/users?action=changepassword",method:"post",data:{currentPassword:this.current,newPassword:this.password}}):t.push((0,G.ZC)(this.$store,S.HG.FIRST_LOGIN,"false"));const s=this.v3User;s.mustChangePassword=!1,this.$store.dispatch("auth/gotUser",s),this.isFirstLogin&&(t.push((0,G.ZC)(this.$store,S.HG.EULA_AGREED,(new Date).toISOString())),t.push((0,G.ZC)(this.$store,S.HG.TELEMETRY,this.telemetry?"in":"out")),this.mcmEnabled&&this.serverUrl&&t.push((0,G.ZC)(this.$store,S.HG.SERVER_URL,this.serverUrl))),await Promise.all(t),await(0,_.f)((()=>!Z(this.$store)),"first login to be completed",1e4,1e3,!0),e(!0),this.done()}catch(s){K.error(s),e(!1),this.errors=(0,M.rz)(s)}},done(){this.$router.replace("/")},onServerUrlChange(e){this.serverUrl=e.trim()}}};s(46593);var V=s(66262);const Y=(0,V.A)(z,[["render",E],["__scopeId","data-v-1546955e"]]),J=Y},46593:(e,t,s)=>{var a=s(80955);a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);var r=s(99548).A;r("5e724a22",a,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=3530.a6302d4a.js.map