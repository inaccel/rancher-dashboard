{"version":3,"file":"js/3530.a6302d4a.js","mappings":"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","sources":["webpack://dashboard/./shell/pages/auth/setup.vue?42de","webpack://dashboard/./shell/pages/auth/setup.vue","webpack://dashboard/./shell/pages/auth/setup.vue?d1b7","webpack://dashboard/./shell/pages/auth/setup.vue?edc9"],"sourcesContent":["// Imports\nimport ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ from \"../../../node_modules/@vue/cli-service/node_modules/css-loader/dist/runtime/noSourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/@vue/cli-service/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.principal[data-v-1546955e]{display:block;background:var(--box-bg);border:1px solid var(--border);border-radius:3px;margin:10px 0;padding:10px;line-height:40px}.principal img[data-v-1546955e]{vertical-align:middle;margin:0 10px}.setup[data-v-1546955e]{overflow:hidden}.setup .row .checkbox[data-v-1546955e]{margin:auto}.setup .row .span-6[data-v-1546955e]{padding:0 60px;margin:0}.setup .row .landscape[data-v-1546955e]{height:100vh;margin:0;-o-object-fit:cover;object-fit:cover;padding:0;width:49%}.setup .form-col[data-v-1546955e]{display:flex;flex-direction:column;overflow-y:auto;position:relative;height:100vh;width:51%}.setup .form-col>div[data-v-1546955e]:first-of-type{flex:3}.setup .form-col>div[data-v-1546955e]:nth-of-type(2){flex:9}.setup .setup-title[data-v-1546955e]  code{font-size:12px;padding:0}.setup .setup-errors[data-v-1546955e]{min-height:50px}.setup p[data-v-1546955e]{line-height:20px}`, \"\"]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","<script>\nimport { randomStr } from '@shell/utils/string';\nimport { LabeledInput } from '@components/Form/LabeledInput';\nimport CopyToClipboard from '@shell/components/CopyToClipboard';\nimport AsyncButton from '@shell/components/AsyncButton';\nimport { LOGGED_OUT, SETUP } from '@shell/config/query-params';\nimport { NORMAN, MANAGEMENT } from '@shell/config/types';\nimport { findBy } from '@shell/utils/array';\nimport { Checkbox } from '@components/Form/Checkbox';\nimport { getVendor, getProduct, setVendor } from '@shell/config/private-label';\nimport { RadioGroup } from '@components/Form/Radio';\nimport { setSetting } from '@shell/utils/settings';\nimport { SETTING } from '@shell/config/settings';\nimport { isDevBuild } from '@shell/utils/version';\nimport { exceptionToErrorsArray } from '@shell/utils/error';\nimport Password from '@shell/components/form/Password';\nimport { applyProducts } from '@shell/store/type-map';\nimport BrandImage from '@shell/components/BrandImage';\nimport { waitFor } from '@shell/utils/async';\nimport { Banner } from '@components/Banner';\nimport FormValidation from '@shell/mixins/form-validation';\nimport isUrl from 'is-url';\nimport { isLocalhost } from '@shell/utils/validators/setting';\nimport Loading from '@shell/components/Loading';\n\nconst calcIsFirstLogin = (store) => {\n  const firstLoginSetting = store.getters['management/byId'](MANAGEMENT.SETTING, SETTING.FIRST_LOGIN);\n\n  return firstLoginSetting?.value === 'true';\n};\n\nconst calcMustChangePassword = async(store) => {\n  await store.dispatch('auth/getUser');\n\n  const out = store.getters['auth/v3User']?.mustChangePassword;\n\n  return out;\n};\n\nexport default {\n  mixins: [FormValidation],\n\n  data() {\n    return {\n      passwordOptions: [\n        { label: this.t('setup.useRandom'), value: true },\n        { label: this.t('setup.useManual'), value: false }],\n      fvFormRuleSets: [{\n        path:       'serverUrl',\n        rootObject: this,\n        rules:      ['required', 'https', 'url', 'trailingForwardSlash']\n      }],\n      productName: '',\n      vendor:      getVendor(),\n      product:     getProduct(),\n      step:        parseInt(this.$route.query.step, 10) || 1,\n\n      useRandom:          true,\n      haveCurrent:        false,\n      username:           null,\n      isFirstLogin:       false,\n      mustChangePassword: false,\n      current:            null,\n      password:           randomStr(),\n      confirm:            null,\n      v3User:             null,\n      serverUrl:          null,\n      mcmEnabled:         null,\n      telemetry:          null,\n      eula:               false,\n      principals:         null,\n      errors:             []\n    };\n  },\n\n  async beforeCreate() {\n    const isFirstLogin = calcIsFirstLogin(this.$store);\n    const mustChangePassword = await calcMustChangePassword(this.$store);\n\n    if (isFirstLogin) {\n      // Always show setup if this is the first log in\n      return;\n    } else if (mustChangePassword) {\n      // If the password needs changing and this isn't the first log in ensure we have the password\n      if (!!this.$store.getters['auth/initialPass']) {\n        // Got it... show setup\n        return;\n      }\n      // Haven't got it... redirect to log in so we get it\n      await this.$store.dispatch('auth/logout', null, { root: true });\n\n      return this.$router.replace(`/auth/login?${ LOGGED_OUT }`);\n    }\n\n    // For all other cases we don't need to show setup\n    return this.$router.replace('/');\n  },\n\n  components: {\n    AsyncButton, LabeledInput, CopyToClipboard, Checkbox, RadioGroup, Password, BrandImage, Banner, Loading\n  },\n\n  async fetch() {\n    const telemetrySetting = this.$store.getters['management/byId'](MANAGEMENT.SETTING, SETTING.TELEMETRY);\n    const serverUrlSetting = this.$store.getters['management/byId'](MANAGEMENT.SETTING, SETTING.SERVER_URL);\n    const rancherVersionSetting = this.$store.getters['management/byId'](MANAGEMENT.SETTING, SETTING.VERSION_RANCHER);\n    let telemetry = true;\n\n    if (telemetrySetting?.value && telemetrySetting.value !== 'prompt') {\n      telemetry = telemetrySetting.value !== 'out';\n    } else if (!rancherVersionSetting?.value || isDevBuild(rancherVersionSetting?.value)) {\n      telemetry = false;\n    }\n\n    let plSetting;\n\n    try {\n      plSetting = this.$store.getters['management/byId'](MANAGEMENT.SETTING, SETTING.PL);\n    } catch (e) {\n      // Older versions used Norman API to get these\n      plSetting = await this.$store.dispatch('rancher/find', {\n        type: NORMAN.SETTING,\n        id:   SETTING.PL,\n        opt:  { url: `/v3/settings/${ SETTING.PL }` }\n      });\n    }\n\n    if (plSetting.value?.length && plSetting.value !== getVendor()) {\n      setVendor(plSetting.value);\n    }\n\n    const productName = plSetting.default;\n\n    const principals = await this.$store.dispatch('rancher/findAll', { type: NORMAN.PRINCIPAL, opt: { url: '/v3/principals' } });\n    const me = findBy(principals, 'me', true);\n\n    const current = this.$route.query[SETUP] || this.$store.getters['auth/initialPass'];\n    const v3User = this.$store.getters['auth/v3User'] ?? {};\n\n    const mcmFeature = await this.$store.dispatch('management/find', {\n      type: MANAGEMENT.FEATURE, id: 'multi-cluster-management', opt: { url: `/v1/${ MANAGEMENT.FEATURE }/multi-cluster-management` }\n    });\n\n    const mcmEnabled = mcmFeature?.spec?.value || mcmFeature?.status?.default;\n\n    let serverUrl;\n\n    if (serverUrlSetting?.value) {\n      serverUrl = serverUrlSetting.value;\n    } else {\n      serverUrl = window.location.origin;\n    }\n\n    const isFirstLogin = await calcIsFirstLogin(this.$store);\n    const mustChangePassword = await calcMustChangePassword(this.$store);\n\n    this['productName'] = productName;\n    this['haveCurrent'] = !!current;\n    this['username'] = me?.loginName || 'admin';\n    this['isFirstLogin'] = isFirstLogin;\n    this['mustChangePassword'] = mustChangePassword;\n    this['current'] = current;\n    this['v3User'] = v3User;\n    this['serverUrl'] = serverUrl;\n    this['mcmEnabled'] = mcmEnabled;\n    this['telemetry'] = telemetry;\n    this['principals'] = principals;\n  },\n\n  computed: {\n    saveEnabled() {\n      if ( !this.eula && this.isFirstLogin) {\n        return false;\n      }\n\n      if ( this.mustChangePassword ) {\n        if ( !this.current ) {\n          return false;\n        }\n\n        if ( !this.useRandom ) {\n          if ( !this.password || this.password !== this.confirm ) {\n            return false;\n          }\n        }\n      }\n\n      if (!isUrl(this.serverUrl) || this.fvGetPathErrors(['serverUrl']).length > 0) {\n        return false;\n      }\n\n      return true;\n    },\n\n    me() {\n      const out = findBy(this.principals, 'me', true);\n\n      return out;\n    },\n\n    showLocalhostWarning() {\n      return isLocalhost(this.serverUrl);\n    }\n  },\n\n  watch: {\n    useRandom(neu) {\n      if (neu) {\n        this.password = randomStr();\n      } else {\n        this.password = '';\n        this.$nextTick(() => {\n          this.$refs.password.focus();\n        });\n      }\n    }\n  },\n\n  methods: {\n    async save(buttonCb) {\n      const promises = [];\n\n      try {\n        await applyProducts(this.$store, this.$plugin);\n        await this.$store.dispatch('loadManagement');\n\n        if ( this.mustChangePassword ) {\n          await this.$store.dispatch('rancher/request', {\n            url:    '/v3/users?action=changepassword',\n            method: 'post',\n            data:   {\n              currentPassword: this.current,\n              newPassword:     this.password\n            },\n          });\n        } else {\n          promises.push(setSetting(this.$store, SETTING.FIRST_LOGIN, 'false'));\n        }\n\n        const user = this.v3User;\n\n        user.mustChangePassword = false;\n        this.$store.dispatch('auth/gotUser', user);\n\n        if (this.isFirstLogin) {\n          promises.push( setSetting(this.$store, SETTING.EULA_AGREED, (new Date()).toISOString()) );\n          promises.push( setSetting(this.$store, SETTING.TELEMETRY, this.telemetry ? 'in' : 'out') );\n\n          if ( this.mcmEnabled && this.serverUrl ) {\n            promises.push( setSetting(this.$store, SETTING.SERVER_URL, this.serverUrl) );\n          }\n        }\n\n        await Promise.all(promises);\n\n        await waitFor(() => !calcIsFirstLogin(this.$store), 'first login to be completed', 10000, 1000, true);\n\n        buttonCb(true);\n        this.done();\n      } catch (err) {\n        console.error(err) ; // eslint-disable-line no-console\n        buttonCb(false);\n        this.errors = exceptionToErrorsArray(err);\n      }\n    },\n\n    done() {\n      this.$router.replace('/');\n    },\n\n    onServerUrlChange(value) {\n      this.serverUrl = value.trim();\n    },\n  },\n};\n</script>\n\n<template>\n  <Loading\n    v-if=\"$fetchState.pending\"\n    mode=\"relative\"\n  />\n  <form\n    v-else\n    class=\"setup\"\n    @submit.prevent\n  >\n    <div class=\"row\">\n      <div class=\"col span-6 form-col\">\n        <div>\n          &nbsp;\n        </div>\n        <div>\n          <h1 class=\"text-center\">\n            {{ t('setup.welcome', {product}) }}\n          </h1>\n\n          <template v-if=\"mustChangePassword\">\n            <p\n              v-clean-html=\"t(isFirstLogin ? 'setup.setPassword' : 'setup.newUserSetPassword', { username }, true)\"\n              class=\"text-center mb-20 mt-20 setup-title\"\n            />\n            <Password\n              v-if=\"!haveCurrent\"\n              v-model:value.trim=\"current\"\n              autocomplete=\"current-password\"\n              type=\"password\"\n              :label=\"t('setup.currentPassword')\"\n              class=\"mb-20\"\n              :required=\"true\"\n            />\n\n            <!-- For password managers... -->\n            <input\n              type=\"hidden\"\n              name=\"username\"\n              autocomplete=\"username\"\n              :value=\"username\"\n            >\n            <div class=\"mb-20\">\n              <RadioGroup\n                v-model:value=\"useRandom\"\n                data-testid=\"setup-password-mode\"\n                name=\"password-mode\"\n                :options=\"passwordOptions\"\n              />\n            </div>\n            <div class=\"mb-20\">\n              <LabeledInput\n                v-if=\"useRandom\"\n                ref=\"password\"\n                v-model:value.trim=\"password\"\n                :type=\"useRandom ? 'text' : 'password'\"\n                :disabled=\"useRandom\"\n                data-testid=\"setup-password-random\"\n                label-key=\"setup.newPassword\"\n              >\n                <template\n                  v-if=\"useRandom\"\n                  #suffix\n                >\n                  <div\n                    class=\"addon\"\n                    style=\"padding: 0 0 0 12px;\"\n                  >\n                    <CopyToClipboard\n                      :text=\"password\"\n                      class=\"btn-sm\"\n                    />\n                  </div>\n                </template>\n              </LabeledInput>\n              <Password\n                v-else\n                ref=\"password\"\n                v-model:value.trim=\"password\"\n                :label=\"t('setup.newPassword')\"\n                data-testid=\"setup-password\"\n                :required=\"true\"\n              />\n            </div>\n            <Password\n              v-show=\"!useRandom\"\n              v-model:value.trim=\"confirm\"\n              autocomplete=\"new-password\"\n              data-testid=\"setup-password-confirm\"\n              :label=\"t('setup.confirmPassword')\"\n              :required=\"true\"\n            />\n          </template>\n\n          <template v-if=\"isFirstLogin\">\n            <template v-if=\"mcmEnabled\">\n              <hr\n                v-if=\"mustChangePassword\"\n                class=\"mt-20 mb-20\"\n              >\n              <p>\n                <t\n                  k=\"setup.serverUrl.tip\"\n                  :raw=\"true\"\n                />\n              </p>\n              <div class=\"mt-20\">\n                <Banner\n                  v-if=\"showLocalhostWarning\"\n                  color=\"warning\"\n                  :label=\"t('validation.setting.serverUrl.localhost')\"\n                  data-testid=\"setup-serverurl-localhost-warning\"\n                />\n                <Banner\n                  v-for=\"(err, i) in fvGetPathErrors(['serverUrl'])\"\n                  :key=\"i\"\n                  color=\"error\"\n                  :label=\"err\"\n                  data-testid=\"setup-error-banner\"\n                />\n                <LabeledInput\n                  v-model:value=\"serverUrl\"\n                  :label=\"t('setup.serverUrl.label')\"\n                  data-testid=\"setup-server-url\"\n                  :rules=\"fvGetAndReportPathRules('serverUrl')\"\n                  :required=\"true\"\n                  @update:value=\"onServerUrlChange\"\n                />\n              </div>\n            </template>\n\n            <div class=\"checkbox mt-40\">\n              <Checkbox\n                id=\"checkbox-telemetry\"\n                v-model:value=\"telemetry\"\n              >\n                <template #label>\n                  <t\n                    k=\"setup.telemetry\"\n                    :raw=\"true\"\n                    :name=\"productName\"\n                  />\n                </template>\n              </Checkbox>\n            </div>\n            <div class=\"checkbox pt-10 eula\">\n              <Checkbox\n                id=\"checkbox-eula\"\n                v-model:value=\"eula\"\n                data-testid=\"setup-agreement\"\n              >\n                <template #label>\n                  <t\n                    k=\"setup.eula\"\n                    :raw=\"true\"\n                    :name=\"productName\"\n                  />\n                </template>\n              </Checkbox>\n            </div>\n          </template>\n\n          <div\n            id=\"submit\"\n            class=\"text-center mt-20\"\n          >\n            <AsyncButton\n              key=\"passwordSubmit\"\n              type=\"submit\"\n              mode=\"continue\"\n              :disabled=\"!saveEnabled\"\n              data-testid=\"setup-submit\"\n              @click=\"save\"\n            />\n          </div>\n\n          <div class=\"setup-errors mt-20\">\n            <h4\n              v-for=\"(err, i) in errors\"\n              :key=\"i\"\n              class=\"text-error text-center\"\n            >\n              {{ err }}\n            </h4>\n          </div>\n        </div>\n      </div>\n      <BrandImage\n        class=\"col span-6 landscape\"\n        file-name=\"login-landscape.svg\"\n      />\n    </div>\n  </form>\n</template>\n\n<style lang=\"scss\" scoped>\n  .principal {\n    display: block;\n    background: var(--box-bg);\n    border: 1px solid var(--border);\n    border-radius: 3px;\n    margin: 10px 0;\n    padding: 10px;\n    line-height: 40px;\n\n    img {\n      vertical-align: middle;\n      margin: 0 10px;\n    }\n  }\n\n  .setup {\n    overflow: hidden;\n\n    .row {\n      & .checkbox {\n        margin: auto\n      }\n\n      .span-6 {\n        padding: 0 60px;\n        margin: 0;\n      }\n\n      .landscape {\n        height: 100vh;\n        margin: 0;\n        object-fit: cover;\n        padding: 0;\n        width: 49%;\n      }\n    }\n\n    .form-col {\n      display: flex;\n      flex-direction: column;\n      overflow-y: auto;\n      position: relative;\n      height: 100vh;\n      width: 51%;\n\n      & > div:first-of-type {\n        flex:3;\n      }\n      & > div:nth-of-type(2) {\n        flex: 9;\n      }\n    }\n\n    .setup-title {\n      :deep() code {\n        font-size: 12px;\n        padding: 0;\n      }\n    }\n\n    .setup-errors {\n      min-height: 50px;\n    }\n\n    p {\n      line-height: 20px;\n    }\n  }\n</style>\n","import { render } from \"./setup.vue?vue&type=template&id=1546955e&scoped=true\"\nimport script from \"./setup.vue?vue&type=script&lang=js\"\nexport * from \"./setup.vue?vue&type=script&lang=js\"\n\nimport \"./setup.vue?vue&type=style&index=0&id=1546955e&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-1546955e\"]])\n\nexport default __exports__","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??clonedRuleSet-22.use[1]!../../../node_modules/vue-loader/dist/stylePostLoader.js!../../../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-22.use[2]!../../../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-22.use[3]!../../../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-22.use[4]!../../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!../../../node_modules/vue-loader/dist/index.js??ruleSet[0].use[1]!./setup.vue?vue&type=style&index=0&id=1546955e&lang=scss&scoped=true\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"5e724a22\", content, true, {\"sourceMap\":false,\"shadowMode\":false});"],"names":["___CSS_LOADER_EXPORT___","push","module","id","class","style","$fetchState","mode","t","product","isFirstLogin","username","haveCurrent","value","current","autocomplete","type","label","required","name","useRandom","options","passwordOptions","ref","password","disabled","text","confirm","k","raw","color","fvGetPathErrors","err","i","key","serverUrl","onServerUrlChange","rules","fvGetAndReportPathRules","telemetry","productName","eula","saveEnabled","save","errors","calcIsFirstLogin","store","firstLoginSetting","getters","SETTING","FIRST_LOGIN","calcMustChangePassword","async","dispatch","out","mustChangePassword","mixins","data","this","fvFormRuleSets","path","rootObject","vendor","step","parseInt","$route","query","v3User","mcmEnabled","principals","beforeCreate","$store","root","$router","replace","components","AsyncButton","LabeledInput","CopyToClipboard","Checkbox","RadioGroup","Password","BrandImage","Banner","Loading","fetch","telemetrySetting","TELEMETRY","serverUrlSetting","SERVER_URL","rancherVersionSetting","VERSION_RANCHER","plSetting","PL","e","opt","url","length","default","PRINCIPAL","me","mcmFeature","FEATURE","spec","status","window","location","origin","loginName","computed","showLocalhostWarning","watch","neu","$nextTick","$refs","focus","methods","buttonCb","promises","applyProducts","$plugin","method","currentPassword","newPassword","user","EULA_AGREED","Date","toISOString","Promise","all","done","console","error","trim","__exports__","render","content","__esModule","locals","exports","add"],"sourceRoot":""}