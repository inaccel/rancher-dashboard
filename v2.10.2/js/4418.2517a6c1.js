(self["webpackChunkdashboard"]=self["webpackChunkdashboard"]||[]).push([[4418],{71249:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var i=s(45522),n=s.n(i),a=s(67643),r=s.n(a),l=r()(n());l.push([e.id,".form-user-retention[data-v-526ed326]{display:flex;flex:1;flex-direction:column;gap:1.5rem}.footer-user-retention[data-v-526ed326]{border-top:var(--header-border-size) solid var(--header-border);right:0;position:sticky;bottom:0;background-color:var(--header-bg);margin-left:-20px;margin-right:-20px;margin-bottom:-20px;margin-top:20px;padding:10px 20px}.footer-user-retention[data-v-526ed326]  .spacer-small{padding:0}.input-fieldset[data-v-526ed326]{display:flex;flex-direction:column;gap:.75rem}.input-fieldset.condensed[data-v-526ed326]{gap:.25rem}.input-fieldset.pt-12[data-v-526ed326]{padding-top:3rem}.input-field[data-v-526ed326]{max-width:24rem}.input-detail[data-v-526ed326]{color:var(--input-label);padding-left:61px}",""]);const o=l},74418:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>B});var i=s(20641),n=s(90033),a=s(37676),r=s(75220),l=s(98914);const o={class:"title"},u={"data-testid":"charts-header-title",class:"m-0"},d=(0,i.pM)({__name:"user-retention-header",setup(e){return(e,t)=>{const s=(0,i.g2)("router-link");return(0,i.uX)(),(0,i.CE)("div",null,[(0,i.Lk)("header",null,[(0,i.Lk)("div",o,[(0,i.Lk)("h1",u,[(0,i.bF)((0,a.R1)(l.A),{"show-child":!1},{default:(0,i.k6)((()=>[(0,i.eW)((0,n.toDisplayString)(e.t("user.retention.edit.title.header")),1)])),_:1}),(0,i.eW)(),(0,i.bF)(s,{to:{name:"c-cluster-product-resource",params:{cluster:"_",product:"auth",resource:"management.cattle.io.user"}}},{default:(0,i.k6)((()=>[(0,i.eW)((0,n.toDisplayString)(e.t("user.retention.edit.title.pre")),1)])),_:1},8,["to"]),(0,i.eW)(" "+(0,n.toDisplayString)(e.t("user.retention.edit.title.post")),1)])])]),(0,i.eW)(),(0,i.Lk)("h2",null,(0,n.toDisplayString)(e.t("user.retention.edit.title.subTitle")),1)])}}}),c=d,f=c;var h=s(24547),E=s(66278),v=s(1581);let R=null;const p=e=>{if(R=e,!R)throw new Error("usI18n() must be called from setup()");return{t:m}},m=(e,t,s)=>(0,v.td)(R,e,t,s);var _=s(25783),A=s(3378),T=s(74353),b=s.n(T),I=s(43522),S=s.n(I);b().extend(S());class U extends Error{constructor(e){super(e),this.isExpected=!0,this.name="ExpectedError"}}const N=(e,t,s)=>{const n=(0,E.Pj)(),{t:r}=p(n),l=(0,a.KR)({[_.HG.DISABLE_INACTIVE_USER_AFTER]:!0,[_.HG.DELETE_INACTIVE_USER_AFTER]:!0,[_.HG.USER_RETENTION_CRON]:!0}),o=(0,i.EW)((()=>{const e=l.value;return!Object.values(e).includes(!1)})),u=(e,t)=>{l.value[e]=t},d=e=>{const{[e]:t,...s}=l.value;l.value=s},c=e=>{l.value={...l.value,[e]:!0}},f=e=>{const t=/^(\d+)h|(\d+)m|(\d+)s$/,s=null===e||void 0===e?void 0:e.match(t);if(!s)throw new U("Invalid duration format. Accepted duration units are Hours, Minutes, and Seconds ({h|m|s})");const i=s[1]?parseInt(s[1]):0,n=s[2]?parseInt(s[2]):0,a=s[3]?parseInt(s[3]):0;return b().duration({hours:i,minutes:n,seconds:a})},h=s=>{if(e.value||t.value)return!s||"string"===typeof s&&!(0,A.isValidCron)(s)?r("user.retention.edit.form.cron.errorMessage"):void 0},v=t=>{if(e.value)try{f(t)}catch(s){return s.message}},R=e=>{if(t.value)try{f(e)}catch(s){return s.message}},m=e=>{try{const t=f(e),s=b().duration({hours:336});if(t.asMilliseconds()<s.asMilliseconds())return`Invalid value: "${e}": must be at least 336h0m0s`}catch(t){if(!(t instanceof U))return t.message}},T=e=>{var t,i;try{const n=f(e),a=b().duration({minutes:null===(t=s.value)||void 0===t?void 0:t.value});if(n.asMilliseconds()<a.asMilliseconds())return`Invalid value: "${e}": must be at least ${_.HG.AUTH_USER_SESSION_TTL_MINUTES} (${null===(i=s.value)||void 0===i?void 0:i.value}m)`}catch(n){if(!(n instanceof U))return n.message}};return{validateUserRetentionCron:h,validateDisableInactiveUserAfterDuration:v,validateDeleteInactiveUserAfterDuration:R,validateDeleteInactiveUserAfter:m,validateDurationAgainstAuthUserSession:T,setValidation:u,removeValidation:d,addValidation:c,isFormValid:o}};var g=s(45848),L=s(1677),$=s(15203),y=s(32255),D=s(6130),G=s(729);const H={key:0,class:"form-user-retention"},F={class:"input-fieldset"},k={class:"input-fieldset"},C={class:"input-fieldset pt-12"},M={class:"input-fieldset condensed pt-12"},O={class:"input-detail"},V={class:"input-fieldset condensed"},w=(0,i.pM)({__name:"index",setup(e){const t=(0,E.Pj)(),s=(0,a.Kh)({[_.HG.DISABLE_INACTIVE_USER_AFTER]:null,[_.HG.DELETE_INACTIVE_USER_AFTER]:null,[_.HG.USER_RETENTION_CRON]:null,[_.HG.USER_RETENTION_DRY_RUN]:null,[_.HG.USER_LAST_LOGIN_DEFAULT]:null}),l=(0,a.KR)(null),o=(0,a.KR)(!1),u=(0,a.KR)(!1),d=(0,a.KR)(!0),{validateUserRetentionCron:c,validateDisableInactiveUserAfterDuration:v,validateDeleteInactiveUserAfterDuration:R,validateDeleteInactiveUserAfter:m,validateDurationAgainstAuthUserSession:A,setValidation:T,removeValidation:I,addValidation:S,isFormValid:U}=N(o,u,l);let w={};(0,i.wB)(o,(e=>{s[_.HG.DISABLE_INACTIVE_USER_AFTER]=e?w[_.HG.DISABLE_INACTIVE_USER_AFTER].value:null})),(0,i.wB)(u,(e=>{s[_.HG.DELETE_INACTIVE_USER_AFTER]=e?w[_.HG.DELETE_INACTIVE_USER_AFTER].value:null})),(0,i.wB)([o,u],(([e,t])=>{if(!e&&!t)return B.forEach((e=>{s[e]=null})),void I(_.HG.USER_RETENTION_CRON);B.filter((e=>![_.HG.DISABLE_INACTIVE_USER_AFTER,_.HG.DELETE_INACTIVE_USER_AFTER].includes(e))).forEach(x),S(_.HG.USER_RETENTION_CRON)}));const x=e=>{if(w[e].id===_.HG.USER_LAST_LOGIN_DEFAULT&&w[e].value&&"string"===typeof w[e].value){const t=w[e].value;s[e]=b()(t).valueOf().toString()}else s[e]=w[e].value},W=async e=>await t.dispatch("management/find",{type:g.Mc.SETTING,id:e}),B=Object.keys(s),P=B.map((e=>W(e)));(0,i.sV)((async()=>{w=await Promise.all(P).then((e=>e.reduce(((e,t)=>({[t.id]:t,...e})),{}))),B.forEach(x),l.value=await W(_.HG.AUTH_USER_SESSION_TTL_MINUTES),o.value=!!s[_.HG.DISABLE_INACTIVE_USER_AFTER],u.value=!!s[_.HG.DELETE_INACTIVE_USER_AFTER],d.value=!1}));const{t:j}=p(t),K=(0,a.KR)(null),Y=async e=>{try{K.value=null,B.forEach((e=>{w[e].value=s[e],e===_.HG.USER_LAST_LOGIN_DEFAULT&&s[e]&&(w[e].value=b()(Number(s[e])).format())})),await Promise.all(B.map((e=>w[e].save()))),e(!0),t.dispatch("growl/success",{title:j("user.retention.growl.title"),message:j("user.retention.growl.message")},{root:!0}),Q()}catch(i){K.value=i.message,e(!1)}},X=(0,r.rd)(),Q=()=>{X.back()};return(0,r.V6)(((e,s)=>{(0,L.isAdminUser)(t.getters)||X.replace({name:"home"})})),(e,t)=>((0,i.uX)(),(0,i.CE)("div",null,[(0,i.bF)(f),(0,i.eW)(),d.value?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",H,[K.value?((0,i.uX)(),(0,i.Wv)($.A,{key:0,color:"error"},{default:(0,i.k6)((()=>[(0,i.eW)((0,n.toDisplayString)(K.value),1)])),_:1})):(0,i.Q3)("",!0),(0,i.eW)(),(0,i.Lk)("div",F,[(0,i.bF)(y.A,{value:o.value,"onUpdate:value":t[0]||(t[0]=e=>o.value=e),"data-testid":"disableAfterPeriod",label:(0,a.R1)(j)("user.retention.edit.form.disableAfter.checkbox")},null,8,["value","label"]),(0,i.eW)(),(0,i.bF)(D.A,{value:s[(0,a.R1)(_.HG).DISABLE_INACTIVE_USER_AFTER],"onUpdate:value":t[1]||(t[1]=e=>s[(0,a.R1)(_.HG).DISABLE_INACTIVE_USER_AFTER]=e),"data-testid":"disableAfterPeriodInput",tooltip:(0,a.R1)(j)("user.retention.edit.form.disableAfter.input.tooltip"),class:"input-field",label:(0,a.R1)(j)("user.retention.edit.form.disableAfter.input.label"),disabled:!o.value,rules:[(0,a.R1)(v),(0,a.R1)(A)],"onUpdate:validation":t[2]||(t[2]=e=>(0,a.R1)(T)((0,a.R1)(_.HG).DISABLE_INACTIVE_USER_AFTER,e))},null,8,["value","tooltip","label","disabled","rules"])]),(0,i.eW)(),(0,i.Lk)("div",k,[(0,i.bF)(y.A,{value:u.value,"onUpdate:value":t[3]||(t[3]=e=>u.value=e),"data-testid":"deleteAfterPeriod",label:(0,a.R1)(j)("user.retention.edit.form.deleteAfter.checkbox")},null,8,["value","label"]),(0,i.eW)(),(0,i.bF)(D.A,{value:s[(0,a.R1)(_.HG).DELETE_INACTIVE_USER_AFTER],"onUpdate:value":t[4]||(t[4]=e=>s[(0,a.R1)(_.HG).DELETE_INACTIVE_USER_AFTER]=e),"data-testid":"deleteAfterPeriodInput",tooltip:(0,a.R1)(j)("user.retention.edit.form.deleteAfter.input.tooltip"),class:"input-field",label:(0,a.R1)(j)("user.retention.edit.form.deleteAfter.input.label"),"sub-label":(0,a.R1)(j)("user.retention.edit.form.deleteAfter.input.subLabel"),disabled:!u.value,rules:[(0,a.R1)(R),(0,a.R1)(A),(0,a.R1)(m)],"onUpdate:validation":t[5]||(t[5]=e=>(0,a.R1)(T)((0,a.R1)(_.HG).DELETE_INACTIVE_USER_AFTER,e))},null,8,["value","tooltip","label","sub-label","disabled","rules"])]),(0,i.eW)(),o.value||u.value?((0,i.uX)(),(0,i.CE)(i.FK,{key:1},[(0,i.Lk)("div",C,[(0,i.bF)(D.A,{value:s[(0,a.R1)(_.HG).USER_RETENTION_CRON],"onUpdate:value":t[6]||(t[6]=e=>s[(0,a.R1)(_.HG).USER_RETENTION_CRON]=e),"data-testid":"userRetentionCron",class:"input-field",required:"",type:"cron",tooltip:(0,a.R1)(j)("user.retention.edit.form.cron.subLabel"),rules:[(0,a.R1)(c)],label:(0,a.R1)(j)("user.retention.edit.form.cron.label"),"require-dirty":!1,"onUpdate:validation":t[7]||(t[7]=e=>(0,a.R1)(T)((0,a.R1)(_.HG).USER_RETENTION_CRON,e))},null,8,["value","tooltip","rules","label"])]),(0,i.eW)(),(0,i.Lk)("div",M,[(0,i.bF)((0,a.R1)(G.j),{value:s[(0,a.R1)(_.HG).USER_RETENTION_DRY_RUN],"onUpdate:value":t[8]||(t[8]=e=>s[(0,a.R1)(_.HG).USER_RETENTION_DRY_RUN]=e),"data-testid":"userRetentionDryRun",onValue:"true",offValue:"false","on-label":(0,a.R1)(j)("user.retention.edit.form.dryRun.label")},null,8,["value","on-label"]),(0,i.eW)(),(0,i.Lk)("span",O,(0,n.toDisplayString)((0,a.R1)(j)("user.retention.edit.form.dryRun.subLabel")),1)]),(0,i.eW)(),(0,i.Lk)("div",V,[(0,i.bF)(D.A,{value:s[(0,a.R1)(_.HG).USER_LAST_LOGIN_DEFAULT],"onUpdate:value":t[9]||(t[9]=e=>s[(0,a.R1)(_.HG).USER_LAST_LOGIN_DEFAULT]=e),"data-testid":"userLastLoginDefault",class:"input-field",label:(0,a.R1)(j)("user.retention.edit.form.defaultLastLogin.label"),"sub-label":(0,a.R1)(j)("user.retention.edit.form.defaultLastLogin.subLabel"),placeholder:(0,a.R1)(j)("user.retention.edit.form.defaultLastLogin.placeholder")},null,8,["value","label","sub-label","placeholder"])])],64)):(0,i.Q3)("",!0)])),(0,i.eW)(),(0,i.bF)(h.A,{class:"footer-user-retention",mode:"edit","disable-save":!(0,a.R1)(U),onSave:Y,onDone:Q},null,8,["disable-save"])]))}});s(92275);var x=s(66262);const W=(0,x.A)(w,[["__scopeId","data-v-526ed326"]]),B=W},43522:function(e){!function(t,s){e.exports=s()}(0,(function(){"use strict";var e,t,s=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,i={years:31536e6,months:2592e6,days:864e5,hours:36e5,minutes:6e4,seconds:1e3,weeks:6048e5},n=function(e){return e instanceof l},a=function(e,t,s){return new l(e,s,t.$l)},r=function(e){return t.p(e)+"s"},l=function(){function t(e,t,n){var l=this;if(this.$d={},this.$l=n||"en",t)return a(e*i[r(t)],this);if("number"==typeof e)return this.$ms=e,this.parseFromMilliseconds(),this;if("object"==typeof e)return Object.keys(e).forEach((function(t){l.$d[r(t)]=e[t]})),this.calMilliseconds(),this;if("string"==typeof e){var o=e.match(s);if(o)return this.$d.years=o[2],this.$d.months=o[3],this.$d.weeks=o[4],this.$d.days=o[5],this.$d.hours=o[6],this.$d.minutes=o[7],this.$d.seconds=o[8],this.calMilliseconds(),this}return this}var l=t.prototype;return l.calMilliseconds=function(){var e=this;this.$ms=Object.keys(this.$d).reduce((function(t,s){return t+(e.$d[s]||0)*(i[s]||1)}),0)},l.parseFromMilliseconds=function(){var e=this.$ms;this.$d.years=Math.floor(e/31536e6),e%=31536e6,this.$d.months=Math.floor(e/2592e6),e%=2592e6,this.$d.days=Math.floor(e/864e5),e%=864e5,this.$d.hours=Math.floor(e/36e5),e%=36e5,this.$d.minutes=Math.floor(e/6e4),e%=6e4,this.$d.seconds=Math.floor(e/1e3),e%=1e3,this.$d.milliseconds=e},l.toISOString=function(){var e=this.$d.years?this.$d.years+"Y":"",t=this.$d.months?this.$d.months+"M":"",s=+this.$d.days||0;this.$d.weeks&&(s+=7*this.$d.weeks);var i=s?s+"D":"",n=this.$d.hours?this.$d.hours+"H":"",a=this.$d.minutes?this.$d.minutes+"M":"",r=this.$d.seconds||0;this.$d.milliseconds&&(r+=this.$d.milliseconds/1e3);var l=r?r+"S":"",o="P"+e+t+i+(n||a||l?"T":"")+n+a+l;return"P"===o?"P0D":o},l.toJSON=function(){return this.toISOString()},l.as=function(e){return this.$ms/(i[r(e)]||1)},l.get=function(e){var t=this.$ms,s=r(e);return"milliseconds"===s?t%=1e3:t="weeks"===s?Math.floor(t/i[s]):this.$d[s],t},l.add=function(e,t,s){var l;return l=t?e*i[r(t)]:n(e)?e.$ms:a(e,this).$ms,a(this.$ms+l*(s?-1:1),this)},l.subtract=function(e,t){return this.add(e,t,!0)},l.locale=function(e){var t=this.clone();return t.$l=e,t},l.clone=function(){return a(this.$ms,this)},l.humanize=function(t){return e().add(this.$ms,"ms").locale(this.$l).fromNow(!t)},l.milliseconds=function(){return this.get("milliseconds")},l.asMilliseconds=function(){return this.as("milliseconds")},l.seconds=function(){return this.get("seconds")},l.asSeconds=function(){return this.as("seconds")},l.minutes=function(){return this.get("minutes")},l.asMinutes=function(){return this.as("minutes")},l.hours=function(){return this.get("hours")},l.asHours=function(){return this.as("hours")},l.days=function(){return this.get("days")},l.asDays=function(){return this.as("days")},l.weeks=function(){return this.get("weeks")},l.asWeeks=function(){return this.as("weeks")},l.months=function(){return this.get("months")},l.asMonths=function(){return this.as("months")},l.years=function(){return this.get("years")},l.asYears=function(){return this.as("years")},t}();return function(s,i,r){e=r,t=r().$utils(),r.duration=function(e,t){return a(e,{},t)},r.isDuration=n}}))},92275:(e,t,s)=>{var i=s(71249);i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[e.id,i,""]]),i.locals&&(e.exports=i.locals);var n=s(99548).A;n("2cfaf87e",i,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=4418.2517a6c1.js.map