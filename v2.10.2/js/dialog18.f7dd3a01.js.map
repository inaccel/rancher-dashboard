{"version":3,"file":"js/dialog18.f7dd3a01.js","mappings":"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","sources":["webpack://dashboard/./shell/dialog/RollbackWorkloadDialog.vue?5b72","webpack://dashboard/./shell/dialog/RollbackWorkloadDialog.vue","webpack://dashboard/./shell/dialog/RollbackWorkloadDialog.vue?9428","webpack://dashboard/./shell/dialog/RollbackWorkloadDialog.vue?1ebb"],"sourcesContent":["// Imports\nimport ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ from \"../../node_modules/@vue/cli-service/node_modules/css-loader/dist/runtime/noSourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/@vue/cli-service/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.prompt-rollback[data-v-727826f9]{margin:0}.prompt-rollback[data-v-727826f9]  .card-actions{display:grid}.yaml-editor[data-v-727826f9]{max-height:70vh}.yaml-editor[data-v-727826f9] .root{max-height:65vh}.diff[data-v-727826f9]:disabled{border:none}.diff[data-v-727826f9]:focus{background:transparent;box-shadow:none}[data-v-727826f9]  .card-body{max-height:calc(95vh - 135px);overflow:hidden}`, \"\"]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","<script>\nimport AsyncButton from '@shell/components/AsyncButton';\nimport day from 'dayjs';\nimport { Card } from '@components/Card';\nimport { exceptionToErrorsArray } from '@shell/utils/error';\nimport LabeledSelect from '@shell/components/form/LabeledSelect';\nimport { Banner } from '@components/Banner';\nimport YamlEditor, { EDITOR_MODES } from '@shell/components/YamlEditor';\nimport { WORKLOAD_TYPES } from '@shell/config/types';\nimport { diffFrom } from '@shell/utils/time';\nimport { mapGetters } from 'vuex';\nimport { ACTIVELY_REMOVE, NEVER_ADD } from '@shell/utils/create-yaml';\nimport { DATE_FORMAT, TIME_FORMAT } from '@shell/store/prefs';\nimport { escapeHtml } from '@shell/utils/string';\n\nconst HIDE = [\n  'metadata.labels.pod-template-hash',\n  'spec.selector.matchLabels.pod-template-hash',\n  'spec.template.metadata.labels.pod-template-hash',\n  'metadata.fields'\n];\n\nconst REMOVE = [...ACTIVELY_REMOVE, ...NEVER_ADD, ...HIDE];\n\nconst REMOVE_KEYS = REMOVE.reduce((obj, item) => {\n  obj[item] = true;\n\n  return obj;\n}, {});\n\nexport default {\n  emits: ['close'],\n\n  components: {\n    Card,\n    AsyncButton,\n    LabeledSelect,\n    Banner,\n    YamlEditor,\n  },\n  props: {\n    workload: {\n      type:     Object,\n      required: true\n    }\n  },\n  data() {\n    return {\n      errors:           [],\n      selectedRevision: null,\n      currentRevision:  null,\n      revisions:        [],\n      editorMode:       EDITOR_MODES.DIFF_CODE,\n      showDiff:         false,\n    };\n  },\n  computed: {\n    ...mapGetters({ t: 'i18n/t' }),\n    ...mapGetters(['currentCluster']),\n    workloadName() {\n      return this.workload.metadata.name;\n    },\n    workloadNamespace() {\n      return this.workload.metadata.namespace;\n    },\n    workloadType() {\n      return this.workload.kind.toLowerCase();\n    },\n    revisionsType() {\n      return this.workloadType === 'deployment' ? WORKLOAD_TYPES.REPLICA_SET : 'apps.controllerrevision';\n    },\n    selectedRevisionId() {\n      return this.selectedRevision.id;\n    },\n    sanitizedSelectedRevision() {\n      return this.sanitizeYaml(this.selectedRevision);\n    },\n    timeFormatStr() {\n      const dateFormat = escapeHtml( this.$store.getters['prefs/get'](DATE_FORMAT));\n      const timeFormat = escapeHtml( this.$store.getters['prefs/get'](TIME_FORMAT));\n\n      return `${ dateFormat }, ${ timeFormat }`;\n    },\n  },\n  fetch() {\n    // Fetch revisions of the current workload\n    this.$store.dispatch('cluster/findAll', { type: this.revisionsType })\n      .then(( response ) => {\n        const allRevisions = response;\n\n        const hasRelationshipWithCurrentWorkload = ( replicaSet ) => {\n          const relationshipsOfReplicaSet = replicaSet.metadata.relationships;\n\n          const revisionsOfCurrentWorkload = relationshipsOfReplicaSet.filter(( relationship ) => {\n            const isRevisionOfCurrentWorkload = relationship.fromId && relationship.fromId === `${ this.workloadNamespace }/${ this.workloadName }`;\n\n            return isRevisionOfCurrentWorkload;\n          });\n\n          return revisionsOfCurrentWorkload.length > 0;\n        };\n\n        const workloadRevisions = allRevisions.filter(( replicaSet ) => {\n          return hasRelationshipWithCurrentWorkload( replicaSet );\n        });\n\n        const revisionOptions = workloadRevisions\n          .map( (revision ) => {\n            if (this.isCurrentRevision(revision)) {\n              this.currentRevision = revision;\n            }\n\n            return this.buildRevisionOption( revision );\n          })\n          .sort((a, b) => b.revisionNumber - a.revisionNumber);\n\n        this.revisions = revisionOptions;\n      })\n      .catch(( err ) => {\n        this.errors = exceptionToErrorsArray(err);\n      });\n  },\n  methods: {\n    close() {\n      this.$emit('close');\n    },\n    async save() {\n      try {\n        await this.workload.rollBack(this.currentCluster, this.workload, this.selectedRevision);\n        this.close();\n      } catch (err) {\n        this.errors = exceptionToErrorsArray(err);\n      }\n    },\n    isCurrentRevision(revision) {\n      return revision.revisionNumber === this.workload.currentRevisionNumber;\n    },\n    buildRevisionOption( revision ) {\n      const { revisionNumber } = revision;\n      const isCurrentRevision = this.isCurrentRevision(revision);\n      const now = day();\n      const createdDate = day(revision.metadata.creationTimestamp);\n      const createdDateFormatted = createdDate.format(this.timeFormatStr);\n\n      const revisionAgeObject = diffFrom(createdDate, now, this.t);\n      const revisionAge = `${ createdDateFormatted }, ${ revisionAgeObject.label }`;\n      const units = this.t(revisionAgeObject.unitsKey, { count: revisionAgeObject.label });\n      const currentLabel = this.t('promptRollback.currentLabel');\n\n      const optionLabel = this.t('promptRollback.revisionOption', {\n        revisionNumber,\n        revisionAge,\n        units,\n        currentLabel: isCurrentRevision ? currentLabel : ''\n      });\n\n      return {\n        label:    optionLabel,\n        value:    revision,\n        disabled: isCurrentRevision,\n        revisionNumber\n      };\n    },\n    getOptionLabel(option) {\n      return option.label;\n    },\n    sizeDialog() {\n      const dialogs = document.getElementsByClassName('modal-container');\n      const width = this.showDiff ? '85%' : '600px';\n\n      if (dialogs.length === 1) {\n        dialogs[0].style.setProperty('width', width);\n      }\n    },\n    sanitizeYaml(obj, path = '') {\n      const res = {};\n\n      if (!obj) {\n        return obj;\n      }\n\n      Object.keys(obj).forEach((key) => {\n        const keyPath = !path ? key : `${ path }.${ key }`;\n\n        if (!REMOVE_KEYS[keyPath]) {\n          res[key] = obj[key];\n\n          if (typeof obj[key] === 'object' && !Array.isArray(obj[key])) {\n            res[key] = this.sanitizeYaml(obj[key], keyPath);\n          }\n        }\n      });\n\n      return res;\n    }\n  }\n};\n</script>\n\n<template>\n  <Card\n    class=\"prompt-rollback\"\n    :show-highlight-border=\"false\"\n  >\n    <template #title>\n      <h4 class=\"text-default-text\">\n        {{ t('promptRollback.modalTitle', { workloadName }, true) }}\n      </h4>\n    </template>\n    <template #body>\n      <div class=\"pl-10 pr-10 \">\n        <Banner\n          v-if=\"revisions.length === 1\"\n          color=\"info\"\n          :label=\"t('promptRollback.singleRevisionBanner')\"\n        />\n        <form>\n          <LabeledSelect\n            v-model:value=\"selectedRevision\"\n            class=\"provider\"\n            :label=\"t('promptRollback.dropdownTitle')\"\n            :placeholder=\"t('promptRollback.placeholder')\"\n            :options=\"revisions\"\n            :get-option-label=\"getOptionLabel\"\n          />\n        </form>\n        <Banner\n          v-for=\"(error, i) in errors\"\n          :key=\"i\"\n          class=\"\"\n          color=\"error\"\n          :label=\"error\"\n        />\n        <YamlEditor\n          v-if=\"selectedRevision && showDiff\"\n          :key=\"selectedRevisionId\"\n          v-model:value=\"sanitizedSelectedRevision\"\n          :initial-yaml-values=\"sanitizeYaml(currentRevision)\"\n          class=\"mt-10 \"\n          :editor-mode=\"editorMode\"\n          :as-object=\"true\"\n        />\n      </div>\n    </template>\n    <template #actions>\n      <div class=\"buttons \">\n        <div class=\"left\">\n          <button\n            :disabled=\"!selectedRevision\"\n            class=\"btn role-secondary diff\"\n            @click=\"showDiff = !showDiff; sizeDialog()\"\n          >\n            {{ showDiff ? t('resourceYaml.buttons.hideDiff') : t('resourceYaml.buttons.diff') }}\n          </button>\n        </div>\n        <div class=\"right\">\n          <button\n            class=\"btn role-secondary mr-10\"\n            @click=\"close\"\n          >\n            {{ t('generic.cancel') }}\n          </button>\n          <AsyncButton\n            :action-label=\"t('asyncButton.rollback.action')\"\n            :disabled=\"!selectedRevision\"\n            get-option-label=\"getOptionLabel\"\n            :right-align=\"true\"\n            @click=\"save\"\n          />\n        </div>\n      </div>\n    </template>\n  </Card>\n</template>\n<style lang='scss' scoped>\n\n.prompt-rollback {\n  margin: 0;\n\n  & :deep() .card-actions {\n    display: grid;\n  }\n}\n\n.yaml-editor {\n  max-height: 70vh;\n\n  & :deep().root {\n    max-height: 65vh;\n  }\n}\n\n.diff {\n  &:disabled {\n    border: none;\n  }\n  &:focus {\n    background: transparent;\n    box-shadow: none;\n  }\n}\n\n:deep() .card-body {\n  max-height: calc(95vh - 135px);\n  overflow: hidden;\n}\n\n</style>\n","import { render } from \"./RollbackWorkloadDialog.vue?vue&type=template&id=727826f9&scoped=true\"\nimport script from \"./RollbackWorkloadDialog.vue?vue&type=script&lang=js\"\nexport * from \"./RollbackWorkloadDialog.vue?vue&type=script&lang=js\"\n\nimport \"./RollbackWorkloadDialog.vue?vue&type=style&index=0&id=727826f9&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-727826f9\"]])\n\nexport default __exports__","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??clonedRuleSet-22.use[1]!../../node_modules/vue-loader/dist/stylePostLoader.js!../../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-22.use[2]!../../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-22.use[3]!../../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-22.use[4]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!../../node_modules/vue-loader/dist/index.js??ruleSet[0].use[1]!./RollbackWorkloadDialog.vue?vue&type=style&index=0&id=727826f9&lang=scss&scoped=true\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"00ed85cc\", content, true, {\"sourceMap\":false,\"shadowMode\":false});"],"names":["___CSS_LOADER_EXPORT___","push","module","id","class","title","t","workloadName","body","revisions","length","color","label","value","selectedRevision","placeholder","options","getOptionLabel","errors","error","i","key","showDiff","selectedRevisionId","sanitizedSelectedRevision","sanitizeYaml","currentRevision","editorMode","actions","disabled","sizeDialog","close","save","HIDE","REMOVE","REMOVE_KEYS","reduce","obj","item","emits","components","Card","AsyncButton","LabeledSelect","Banner","YamlEditor","props","workload","type","Object","required","data","DIFF_CODE","computed","this","metadata","name","workloadNamespace","namespace","workloadType","kind","toLowerCase","revisionsType","REPLICA_SET","timeFormatStr","dateFormat","$store","getters","DATE_FORMAT","timeFormat","TIME_FORMAT","fetch","dispatch","then","response","allRevisions","hasRelationshipWithCurrentWorkload","replicaSet","relationshipsOfReplicaSet","relationships","revisionsOfCurrentWorkload","filter","relationship","isRevisionOfCurrentWorkload","fromId","workloadRevisions","revisionOptions","map","revision","isCurrentRevision","buildRevisionOption","sort","a","b","revisionNumber","catch","err","methods","$emit","rollBack","currentCluster","currentRevisionNumber","now","createdDate","creationTimestamp","createdDateFormatted","format","revisionAgeObject","revisionAge","units","unitsKey","count","currentLabel","optionLabel","option","dialogs","document","getElementsByClassName","width","style","setProperty","path","res","keys","forEach","keyPath","Array","isArray","__exports__","render","content","__esModule","default","locals","exports","add"],"sourceRoot":""}