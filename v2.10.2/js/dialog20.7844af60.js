(self["webpackChunkdashboard"]=self["webpackChunkdashboard"]||[]).push([[1817],{73606:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var r=s(45522),i=s.n(r),c=s(67643),a=s.n(c),l=a()(i());l.push([e.id,".prompt-rotate[data-v-f2470cae]{margin:0}.buttons[data-v-f2470cae]{display:flex;justify-content:flex-end;width:100%}.options[data-v-f2470cae]{display:flex;flex-direction:column}.options .service-select[data-v-f2470cae]{margin-left:20px;margin-top:10px;width:-moz-fit-content;width:fit-content;min-width:260px}",""]);const o=l},98160:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>b});var r=s(20641),i=s(90033);const c={class:"options"},a={class:"buttons"};function l(e,t,s,l,o,n){const u=(0,r.g2)("Banner"),d=(0,r.g2)("RadioGroup"),v=(0,r.g2)("Select"),p=(0,r.g2)("AsyncButton"),h=(0,r.g2)("Card");return(0,r.uX)(),(0,r.Wv)(h,{class:"prompt-rotate","show-highlight-border":!1,style:{height:"100%"}},{title:(0,r.k6)((()=>[(0,r.Lk)("h3",null,(0,i.toDisplayString)(e.t("cluster.rotateCertificates.modalTitle")),1)])),body:(0,r.k6)((()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.errors,((e,t)=>((0,r.uX)(),(0,r.Wv)(u,{key:t,class:"",color:"error",label:e},null,8,["label"])))),128)),(0,r.eW)(),(0,r.Lk)("div",c,[(0,r.bF)(d,{value:o.rotateAllServices,"onUpdate:value":t[0]||(t[0]=e=>o.rotateAllServices=e),name:"service-mode",options:[{value:!0,label:e.t("cluster.rotateCertificates.allServices")},{value:!1,label:e.t("cluster.rotateCertificates.selectService")}]},null,8,["value","options"]),(0,r.eW)(),(0,r.bF)(v,{value:o.selectedService,"onUpdate:value":t[1]||(t[1]=e=>o.selectedService=e),options:n.serviceOptions,class:(0,i.normalizeClass)(["service-select",{invisible:o.rotateAllServices}])},null,8,["value","options","class"])])])),actions:(0,r.k6)((()=>[(0,r.Lk)("div",a,[(0,r.Lk)("button",{class:"btn role-secondary mr-20",onClick:t[2]||(t[2]=(...e)=>n.close&&n.close(...e))},(0,i.toDisplayString)(e.t("generic.cancel")),1),(0,r.eW)(),(0,r.bF)(p,{mode:"rotate",disabled:!o.rotateAllServices&&!o.selectedService,onClick:n.rotate},null,8,["disabled","onClick"])])])),_:1})}var o=s(99910),n=s(17793),u=s(17899),d=s(4207),v=s(30362),p=s(13097),h=s(95510);const f={emits:["close"],components:{Select:v.A,RadioGroup:d.z,Card:o.Z,AsyncButton:n.A,Banner:u.l},props:{cluster:{type:Object,default:()=>({})}},data(){return{selectedService:"",rotateAllServices:!0,errors:[]}},computed:{serviceOptions(){if(this.cluster.isRke2){const e=["admin","api-server","controller-manager","scheduler","cloud-controller","etcd","auth-proxy","kubelet","kube-proxy"];return this.cluster.isK3s?e.push("k3s-controller","k3s-server"):e.push("rke2-controller","rke2-server"),e.sort()}const e=this.$store.getters["rancher/schemaFor"]("rotatecertificateinput");return(0,p.get)(e,"resourceFields.services.options")||[]},actionParams(){return this.rotateAllServices?{services:this.cluster.isRke2?[]:null,caCertificates:!1}:{services:this.selectedService,caCertificates:!1}}},mounted(){this.selectedService=this.serviceOptions[0]||""},methods:{close(){this.$emit("close")},async rotate(e){const t=this.actionParams;try{if(this.cluster.isRke2){const e=this.cluster.spec?.rkeConfig?.rotateCertificates?.generation||0;(0,p.set)(this.cluster,"spec.rkeConfig.rotateCertificates",{generation:e+1,services:this.selectedService&&!this.rotateAllServices?[this.selectedService]:[]}),await this.cluster.save()}else await this.cluster.mgmt.doAction("rotateCertificates",t);e(!0),this.close()}catch(s){this.errors=(0,h.rz)(s),e(!1)}}}};s(64952);var m=s(66262);const k=(0,m.A)(f,[["render",l],["__scopeId","data-v-f2470cae"]]),b=k},64952:(e,t,s)=>{var r=s(73606);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);var i=s(99548).A;i("dbfa71a6",r,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=dialog20.7844af60.js.map