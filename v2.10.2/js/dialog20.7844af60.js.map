{"version":3,"file":"js/dialog20.7844af60.js","mappings":"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","sources":["webpack://dashboard/./shell/dialog/RotateCertificatesDialog.vue?c618","webpack://dashboard/./shell/dialog/RotateCertificatesDialog.vue","webpack://dashboard/./shell/dialog/RotateCertificatesDialog.vue?fe32","webpack://dashboard/./shell/dialog/RotateCertificatesDialog.vue?d796"],"sourcesContent":["// Imports\nimport ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ from \"../../node_modules/@vue/cli-service/node_modules/css-loader/dist/runtime/noSourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/@vue/cli-service/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.prompt-rotate[data-v-f2470cae]{margin:0}.buttons[data-v-f2470cae]{display:flex;justify-content:flex-end;width:100%}.options[data-v-f2470cae]{display:flex;flex-direction:column}.options .service-select[data-v-f2470cae]{margin-left:20px;margin-top:10px;width:-moz-fit-content;width:fit-content;min-width:260px}`, \"\"]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","<script>\nimport { Card } from '@components/Card';\nimport AsyncButton from '@shell/components/AsyncButton';\nimport { Banner } from '@components/Banner';\n\nimport { RadioGroup } from '@components/Form/Radio';\nimport Select from '@shell/components/form/Select';\n\nimport { get, set } from '@shell/utils/object';\nimport { exceptionToErrorsArray } from '@shell/utils/error';\n\nexport default {\n  emits: ['close'],\n\n  components: {\n    Select,\n    RadioGroup,\n    Card,\n    AsyncButton,\n    Banner\n  },\n\n  props: {\n    cluster: {\n      type:    Object,\n      default: () => {\n        return {};\n      }\n    }\n  },\n\n  data() {\n    return {\n      selectedService:   '',\n      rotateAllServices: true,\n      errors:            []\n    };\n  },\n\n  computed: {\n    serviceOptions() {\n      if (this.cluster.isRke2) {\n        const options = [\n          'admin',\n          'api-server',\n          'controller-manager',\n          'scheduler',\n          'cloud-controller',\n          'etcd',\n          'auth-proxy',\n          'kubelet',\n          'kube-proxy'\n        ];\n\n        if ( this.cluster.isK3s ) {\n          options.push('k3s-controller', 'k3s-server');\n        } else {\n          options.push('rke2-controller', 'rke2-server');\n        }\n\n        return options.sort();\n      }\n      // For RKE1 clusters, Norman provides the list of service options:\n      // type RotateCertificateInput struct {\n      //   CACertificates bool     `json:\"caCertificates,omitempty\"`\n      //   Services       []string `json:\"services,omitempty\" norman:\"type=enum,options=etcd|kubelet|kube-apiserver|kube-proxy|kube-scheduler|kube-controller-manager\"`\n      // }\n      const schema = this.$store.getters['rancher/schemaFor']('rotatecertificateinput');\n\n      return get(schema, 'resourceFields.services.options') || [];\n    },\n\n    actionParams() {\n      if (this.rotateAllServices) {\n        return {\n          // To rotate all services, RKE1 clusters need services\n          // to be null, while RKE2 requires an empty array.\n          services:       this.cluster.isRke2 ? [] : null,\n          caCertificates: false,\n        };\n      } else {\n        return {\n          services:       this.selectedService,\n          caCertificates: false,\n        };\n      }\n    }\n  },\n\n  mounted() {\n    this.selectedService = this.serviceOptions[0] || '';\n  },\n\n  methods: {\n    close() {\n      this.$emit('close');\n    },\n\n    async rotate(buttonDone) {\n      const params = this.actionParams;\n\n      try {\n        if (this.cluster.isRke2) {\n        // The Steve API doesn't support actions, so for RKE2 cluster cert rotation, we patch the cluster.\n          const currentGeneration = this.cluster.spec?.rkeConfig?.rotateCertificates?.generation || 0;\n\n          set(this.cluster, 'spec.rkeConfig.rotateCertificates', {\n            generation: currentGeneration + 1,\n            services:   (this.selectedService && !this.rotateAllServices) ? [this.selectedService] : []\n          });\n\n          await this.cluster.save();\n        } else {\n          await this.cluster.mgmt.doAction('rotateCertificates', params);\n        }\n        buttonDone(true);\n        this.close();\n      } catch (err) {\n        this.errors = exceptionToErrorsArray(err);\n        buttonDone(false);\n      }\n    }\n  }\n};\n</script>\n\n<template>\n  <Card\n    class=\"prompt-rotate\"\n    :show-highlight-border=\"false\"\n    :style=\"{'height':'100%'}\"\n  >\n    <template #title>\n      <h3>{{ t('cluster.rotateCertificates.modalTitle') }}</h3>\n    </template>\n    <template #body>\n      <Banner\n        v-for=\"(error, i) in errors\"\n        :key=\"i\"\n        class=\"\"\n        color=\"error\"\n        :label=\"error\"\n      />\n      <div class=\"options\">\n        <RadioGroup\n          v-model:value=\"rotateAllServices\"\n          name=\"service-mode\"\n          :options=\"[\n            {\n              value: true,\n              label:t('cluster.rotateCertificates.allServices')\n            },\n            {\n              value: false,\n              label:t('cluster.rotateCertificates.selectService')\n            }\n          ]\"\n        />\n        <Select\n          v-model:value=\"selectedService\"\n          :options=\"serviceOptions\"\n          class=\"service-select\"\n          :class=\"{'invisible': rotateAllServices}\"\n        />\n      </div>\n    </template>\n    <template #actions>\n      <div class=\"buttons\">\n        <button\n          class=\"btn role-secondary mr-20\"\n          @click=\"close\"\n        >\n          {{ t('generic.cancel') }}\n        </button>\n        <AsyncButton\n          mode=\"rotate\"\n          :disabled=\"!rotateAllServices && !selectedService\"\n          @click=\"rotate\"\n        />\n      </div>\n    </template>\n  </Card>\n</template>\n\n<style lang='scss' scoped>\n  .prompt-rotate {\n    margin: 0;\n  }\n  .buttons {\n    display: flex;\n    justify-content: flex-end;\n    width: 100%;\n  }\n  .options {\n    display: flex;\n    flex-direction: column;\n\n    .service-select {\n      margin-left: 20px;\n      margin-top: 10px;\n      width: fit-content;\n      min-width: 260px;\n    }\n  }\n</style>\n","import { render } from \"./RotateCertificatesDialog.vue?vue&type=template&id=f2470cae&scoped=true\"\nimport script from \"./RotateCertificatesDialog.vue?vue&type=script&lang=js\"\nexport * from \"./RotateCertificatesDialog.vue?vue&type=script&lang=js\"\n\nimport \"./RotateCertificatesDialog.vue?vue&type=style&index=0&id=f2470cae&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-f2470cae\"]])\n\nexport default __exports__","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??clonedRuleSet-22.use[1]!../../node_modules/vue-loader/dist/stylePostLoader.js!../../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-22.use[2]!../../node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-22.use[3]!../../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-22.use[4]!../../node_modules/cache-loader/dist/cjs.js??ruleSet[0].use[0]!../../node_modules/vue-loader/dist/index.js??ruleSet[0].use[1]!./RotateCertificatesDialog.vue?vue&type=style&index=0&id=f2470cae&lang=scss&scoped=true\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"dbfa71a6\", content, true, {\"sourceMap\":false,\"shadowMode\":false});"],"names":["___CSS_LOADER_EXPORT___","push","module","id","class","style","title","t","body","errors","error","i","key","color","label","value","rotateAllServices","name","options","selectedService","serviceOptions","actions","close","mode","disabled","rotate","emits","components","Select","RadioGroup","Card","AsyncButton","Banner","props","cluster","type","Object","default","data","computed","this","isRke2","isK3s","sort","schema","$store","getters","get","actionParams","services","caCertificates","mounted","methods","$emit","buttonDone","params","currentGeneration","spec","rkeConfig","rotateCertificates","generation","set","save","mgmt","doAction","err","__exports__","render","content","__esModule","locals","exports","add"],"sourceRoot":""}