(self["webpackChunkdashboard"]=self["webpackChunkdashboard"]||[]).push([[9019],{80189:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>l});var r=s(45522),a=s.n(r),o=s(67643),n=s.n(o),c=n()(a());c.push([t.id,".prompt-rotate[data-v-db414428]{margin:0}.buttons[data-v-db414428]{display:flex;justify-content:flex-end;width:100%}",""]);const l=c},87746:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>B});var r=s(20641),a=s(90033);const o={class:"text-default-text"},n={class:"pl-10 pr-10"},c={key:0},l={key:0,class:"pt-10 pb-10"},i={class:"buttons"};function d(t,e,s,d,p,u){const h=(0,r.g2)("Banner"),y=(0,r.g2)("AsyncButton"),f=(0,r.g2)("Card"),k=(0,r.gN)("clean-html");return(0,r.uX)(),(0,r.Wv)(f,{class:"prompt-rotate","show-highlight-border":!1},{title:(0,r.k6)((()=>[(0,r.bo)((0,r.Lk)("h4",o,null,512),[[k,t.t("promptRotateEncryptionKey.title")]])])),body:(0,r.k6)((()=>[(0,r.Lk)("div",n,[(0,r.bF)(h,{color:"warning","label-key":"promptRotateEncryptionKey.warning"}),(0,r.eW)(),t.$fetchState.pending?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",c,[p.latestBackup?((0,r.uX)(),(0,r.CE)("p",l,(0,a.toDisplayString)(t.t("promptRotateEncryptionKey.description",p.latestBackup,!0)),1)):((0,r.uX)(),(0,r.Wv)(h,{key:1,color:"error","label-key":"promptRotateEncryptionKey.error"}))]))])])),actions:(0,r.k6)((()=>[(0,r.Lk)("div",i,[(0,r.Lk)("button",{class:"btn role-secondary mr-10",onClick:e[0]||(e[0]=(...t)=>u.close&&u.close(...t))},(0,a.toDisplayString)(t.t("generic.cancel")),1),(0,r.eW)(),(0,r.bF)(y,{mode:"rotate",disabled:t.$fetchState.pending||!p.latestBackup,onClick:u.apply},null,8,["disabled","onClick"]),(0,r.eW)(),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(p.errors,((t,e)=>((0,r.uX)(),(0,r.Wv)(h,{key:e,color:"error",label:t},null,8,["label"])))),128))])])),_:1})}var p=s(45848),u=s(17793),h=s(99910),y=s(17899),f=s(95510),k=s(7958),g=s(74353),m=s.n(g),b=s(45363),v=s(97486),C=s(13097);const E={emits:["close"],components:{Card:h.Z,AsyncButton:u.A,Banner:y.l},props:{cluster:{type:Object,default:()=>({})}},async fetch(){if(!this.$store.getters["isRancher"])return[];const t=await this.getEtcdBackups();if(t.length>0){const e=(0,k.Ul)(t,["created"]).reverse(),s=e[0].id.split(":"),r=e[0].created;this.latestBackup={name:s[0],date:this.getFormattedCreatedDate(r)}}},data(){return{errors:[],latestBackup:null}},methods:{close(t){t&&"function"===typeof t&&t(!0),this.$emit("close")},async getEtcdBackups(){if(this.cluster.isRke1){let t=await this.$store.dispatch("rancher/findAll",{type:p.k$.ETCD_BACKUP});return t=t.filter((t=>t.clusterId===this.cluster.metadata.name)),t}if(this.cluster.isRke2){let t=await this.$store.dispatch("management/findAll",{type:p.xO});return t=t.filter((t=>t.clusterId===this.cluster.id)),t}return[]},getFormattedCreatedDate(t){const e=(0,b.ZD)(this.$store.getters["prefs/get"](v.DATE_FORMAT)),s=(0,b.ZD)(this.$store.getters["prefs/get"](v.TIME_FORMAT)),r=m()(t).format(e),a=m()(t).format(s);return`${r} ${a}`},async apply(t){const e=this.cluster.isRke2;try{if(e){const e=this.cluster.spec?.rkeConfig?.rotateEncryptionKeys?.generation||0;(0,C.set)(this.cluster,"spec.rkeConfig.rotateEncryptionKeys.generation",e+1),await this.cluster.save(),this.close(t)}else await this.cluster.mgmt.doAction("rotateEncryptionKey"),this.close(t)}catch(s){this.errors=(0,f.rz)(s),t(!1)}}}};s(1055);var w=s(66262);const A=(0,w.A)(E,[["render",d],["__scopeId","data-v-db414428"]]),B=A},1055:(t,e,s)=>{var r=s(80189);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[t.id,r,""]]),r.locals&&(t.exports=r.locals);var a=s(99548).A;a("116fc410",r,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=dialog22.740863ce.js.map