(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages/diagnostic"],{"35d9":function(t,e,o){"use strict";o.r(e);o("b0c0");var n=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"title-block mt-20 mb-40"},[e("div",[e("AsyncButton",{staticClass:"mr-20",attrs:{mode:"timing","data-testid":"diagnostics-generate-response-times"},on:{click:t.gatherResponseTimes}}),t._v(" "),e("AsyncButton",{attrs:{mode:"diagnostic","data-testid":"diagnostics-download-diagnostic-package"},on:{click:t.promptDownload}})],1)]),t._v(" "),e("div",{staticClass:"mb-40"},[e("h2",{staticClass:"mb-20"},[t._v("\n      "+t._s(t.t("about.diagnostic.systemInformation.subtitle"))+"\n    ")]),t._v(" "),e("table",{staticClass:"full-width"},[t._m(0),t._v(" "),e("tbody",t._l(t.systemInformation,(function(o,n){return e("tr",{key:n},[o.value.length?[e("td",[t._v(t._s(o.label))]),t._v(" "),e("td",[t._v(t._s(o.value))])]:t._e()],2)})),0)])]),t._v(" "),e("div",{staticClass:"mb-40"},[e("h2",{staticClass:"mb-20"},[t._v("\n      "+t._s(t.t("about.diagnostic.resourceCounts",{count:t.clusterCount}))+"\n    ")]),t._v(" "),e("div",{staticClass:"resources-count-container"},t._l(t.finalCounts,(function(o){return e("table",{key:o.id,staticClass:"full-width"},[e("thead",{on:{click:function(e){return t.toggleTable(o.id)}}},[e("th",{attrs:{colspan:"4"}},[e("div",{staticClass:"cluster-row"},[e("span",[t._v("Cluster: "),e("b",[t._v(t._s(o.name))])]),t._v(" "),e("span",[t._v("Namespace: "),e("b",[t._v(t._s(o.namespace))])]),t._v(" "),e("span",[t._v("Total Resources: "),e("b",[t._v(t._s(t.sumResourceCount(o.counts)))])]),t._v(" "),e("span",[t._v("Nodes: "),e("b",[t._v(t._s(t.nodeCount(o.counts)))])]),t._v(" "),e("i",{staticClass:"icon",class:{"icon-chevron-down":!o.isTableVisible,"icon-chevron-up":o.isTableVisible}})])])]),t._v(" "),e("tbody",{directives:[{name:"show",rawName:"v-show",value:o.isTableVisible,expression:"cluster.isTableVisible"}]},[t._m(1,!0),t._v(" "),t._l(o.counts,(function(o){return e("tr",{key:o.resource},[o.count>0?[e("td",{attrs:{scope:"row"}},[t._v("\n                "+t._s(o.resource)+"\n              ")]),t._v(" "),e("td",[t._v(t._s(o.count))]),t._v(" "),e("td",[t._v(t._s(o.durationMs||"-"))])]:t._e()],2)}))],2)])})),0)]),t._v(" "),e("PromptModal")],1)},a=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("Type")]),t._v(" "),e("th",[t._v("Value")])])])},function(){var t=this,e=t._self._c;return e("tr",[e("th",[t._v("\n              Resource\n            ")]),t._v(" "),e("th",[t._v("\n              Count\n            ")]),t._v(" "),e("th",[t._v("\n              Resource Timing (ms)\n            ")])])}],i=o("15fd"),r=o("ade3"),s=o("3835"),c=o("1da1"),d=o("a34a"),l=o.n(d),u=(o("96cf"),o("4de4"),o("d3b7"),o("159b"),o("e260"),o("e6cf"),o("3ca3"),o("ddb0"),o("b64b"),o("99af"),o("a434"),o("7db0"),o("c740"),o("5db7"),o("73d9"),o("d81d"),o("4fad"),o("caad"),o("a4d3"),o("e439"),o("dbb4"),o("a788")),v=o("67c9"),m=o("2abc"),b=o("576a"),p=o("2ade"),f=o("b25d"),h=["list"];function g(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,n)}return o}function y(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?g(Object(o),!0).forEach((function(e){Object(r["a"])(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):g(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}var w={name:"Diagnostic",layout:"plain",components:{AsyncButton:v["b"],PromptModal:m["a"]},fetch:function(){var t=this;return Object(c["a"])(l.a.mark((function e(){var o,n,a,i,r,s,c;return l.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("management/findAll",{type:u["e"].RANCHER_CLUSTER});case 2:return o=e.sent,n=o.filter((function(t){var e;return null===(e=t.mgmt)||void 0===e?void 0:e.isReady})),a=Object(p["b"])(Object(p["c"])(n,t.$store),t.$store),i=[],r=[],s=[],a.forEach((function(e,o){var n,s,c,d,l,v=t.$store.getters["management/byId"](u["B"].CLUSTER,e.metadata.name);i.push({id:e.id,name:(null===v||void 0===v||null===(n=v.spec)||void 0===n?void 0:n.displayName)||(null===(s=e.metadata)||void 0===s?void 0:s.name),namespace:null===(c=e.metadata)||void 0===c?void 0:c.namespace,capiId:null===(d=e.mgmt)||void 0===d?void 0:d.id,counts:null,isTableVisible:!(0!==o||1!==a.length)}),r.push(t.$store.dispatch("management/request",{url:"/k8s/clusters/".concat(null===(l=e.mgmt)||void 0===l?void 0:l.id,"/v1/counts")}))})),e.next=11,Promise.all(r);case 11:c=e.sent,c.forEach((function(t,e){var o,n,a=null===(o=t.data)||void 0===o||null===(n=o[0])||void 0===n?void 0:n.counts;if(a){var r=[],c=[];Object.keys(a).forEach((function(t){var e,o;r[t]=null===(e=a[t].summary)||void 0===e?void 0:e.count,r.push({resource:t,count:(null===(o=a[t].summary)||void 0===o?void 0:o.count)||0})}));var d=Object(f["b"])(r,"count:desc");c=c.concat(d),c=Object(f["b"])(c,"count:desc"),c=c.splice(0,15),c.forEach((function(t,o){c[o].id=i[e].id,c[o].capiId=i[e].capiId})),s.push(c),i[e].counts=d}})),t.topFifteenForResponseTime=s,t.finalCounts=i;case 15:case"end":return e.stop()}}),e)})))()},data:function(){var t,e,o,n,a,i,r,s,c,d,l,u,v,m,b,p,f,h,g,y,w,_,j=null===(t=window)||void 0===t?void 0:t.navigator,C=j.userAgent,O=j.userAgentData,x=j.language,T=j.cookieEnabled,k=j.hardwareConcurrency,I=j.deviceMemory,M={browser:{label:this.t("about.diagnostic.systemInformation.browser"),value:this.t("about.diagnostic.systemInformation.browserInfo",{userAgent:C,language:x,cookieEnabled:T})},system:{label:this.t("about.diagnostic.systemInformation.system"),value:this.t("about.diagnostic.systemInformation.hardwareConcurrency",{hardwareConcurrency:k})},jsMemory:{label:this.t("about.diagnostic.systemInformation.jsMemory"),value:""}};(null!==O&&void 0!==O&&O.platform&&(M.system.value=M.system.value.concat(", ",this.t("about.diagnostic.systemInformation.os",{platform:O.platform}))),I&&(M.system.value=M.system.value.concat(", ",this.t("about.diagnostic.systemInformation.deviceMemory",{deviceMemory:I}))),null!==(e=window)&&void 0!==e&&null!==(o=e.performance)&&void 0!==o&&null!==(n=o.memory)&&void 0!==n&&n.jsHeapSizeLimit)&&(M.jsMemory.value+=this.t("about.diagnostic.systemInformation.memJsHeapLimit",{jsHeapSizeLimit:null===(m=window)||void 0===m||null===(b=m.performance)||void 0===b||null===(p=b.memory)||void 0===p?void 0:p.jsHeapSizeLimit}));null!==(a=window)&&void 0!==a&&null!==(i=a.performance)&&void 0!==i&&null!==(r=i.memory)&&void 0!==r&&r.totalJSHeapSize&&(M.jsMemory.value+=", ".concat(this.t("about.diagnostic.systemInformation.memTotalJsHeapSize",{totalJSHeapSize:null===(f=window)||void 0===f||null===(h=f.performance)||void 0===h||null===(g=h.memory)||void 0===g?void 0:g.totalJSHeapSize})));null!==(s=window)&&void 0!==s&&null!==(c=s.performance)&&void 0!==c&&null!==(d=c.memory)&&void 0!==d&&d.usedJSHeapSize&&(M.jsMemory.value+=", ".concat(this.t("about.diagnostic.systemInformation.memUsedJsHeapSize",{usedJSHeapSize:null===(y=window)||void 0===y||null===(w=y.performance)||void 0===w||null===(_=w.memory)||void 0===_?void 0:_.usedJSHeapSize})));return{systemInformation:M,topFifteenForResponseTime:null,responseTimes:null,finalCounts:null,includeResponseTimes:!0,storeMapping:null===(l=this.$store)||void 0===l||null===(u=l._modules)||void 0===u||null===(v=u.root)||void 0===v?void 0:v.state}},computed:{clusterCount:function(){var t;return null===(t=this.finalCounts)||void 0===t?void 0:t.length}},methods:{generateKey:function(t){var e=1e4*Math.random();return"key_".concat(e,"_").concat(t)},downloadData:function(t){var e="rancher-diagnostic-data.json",o={systemInformation:this.systemInformation,storeMapping:this.parseStoreData(this.storeMapping),resourceCounts:this.finalCounts,responseTimes:this.responseTimes};Object(b["a"])(e,JSON.stringify(o),"application/json").then((function(){return t(!0)})).catch((function(){return t(!1)}))},setResourceResponseTiming:function(t){var e=this;null===t||void 0===t||t.forEach((function(t){if("success"===t.outcome){var o,n=e.finalCounts.find((function(e){return e.capiId===t.item.capiId})),a=null===n||void 0===n||null===(o=n.counts)||void 0===o?void 0:o.findIndex((function(e){return e.resource===t.item.resource}));(a&&-1!==a||0===a)&&e.$set(null===n||void 0===n?void 0:n.counts[a],"durationMs",t.durationMs)}}))},sumResourceCount:function(t){return t.reduce((function(t,e){return t+e.count}),0)},nodeCount:function(t){var e,o=t.findIndex((function(t){return"node"===t.resource}));return null===(e=t[o])||void 0===e?void 0:e.count},toggleTable:function(t){var e=this.finalCounts.findIndex((function(e){return e.id===t}));this.finalCounts[e].isTableVisible=!this.finalCounts[e].isTableVisible},gatherResponseTimes:function(t){var e=this;return Object(c["a"])(l.a.mark((function o(){var n;return l.a.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return n=e.topFifteenForResponseTime.flatMap((function(t){return t.map((function(t){var o=Date.now();return e.$store.dispatch("management/request",{url:"/k8s/clusters/".concat(t.capiId,"/v1/").concat(t.resource)}).then((function(){return{outcome:"success",item:t,durationMs:Date.now()-o}})).catch((function(){return{outcome:"error",item:t,durationMs:Date.now()-o}}))}))})),o.next=3,Promise.all(n).then((function(o){e.responseTimes=o,e.setResourceResponseTiming(o),t(!0)})).catch((function(){return t(!1)}));case 3:return o.abrupt("return",o.sent);case 4:case"end":return o.stop()}}),o)})))()},parseStoreData:function(t){var e=["aws","digitalocean","linode","targetRoute"],o=["management","rancher","cluster","harvester","epinio","elemental"],n={};return Object.entries(t).forEach((function(t){var a=Object(s["a"])(t,2),r=a[0],c=a[1];e.includes(r)||(o.includes(r)&&Object.keys(c.types||{}).length?(n[r]=y(y({},c),{},{types:{}}),Object.entries(c.types).forEach((function(t){var e=Object(s["a"])(t,2),o=e[0],a=e[1],c=a.list,d=Object(i["a"])(a,h);n[r].types[o]=y(y({},d),{},{count:c.length})}))):n[r]=c)})),n},promptDownload:function(t){this.responseTimes?this.downloadData(t):this.$store.dispatch("management/promptModal",{component:"DiagnosticTimingsDialog",componentProps:{downloadData:this.downloadData,gatherResponseTimes:this.gatherResponseTimes}}).then((function(){return t(!0)})).catch((function(){return t(!1)}))}}},_=w,j=(o("f05d"),o("0c7c")),C=Object(j["a"])(_,n,a,!1,null,"001dab86",null);e["default"]=C.exports},"44da":function(t,e,o){var n=o("4bad");e=n(!1),e.push([t.i,".title-block[data-v-001dab86]{display:flex;justify-content:right;align-items:center}.title-block h1[data-v-001dab86]{margin:0!important}.title-block div[data-v-001dab86]{display:flex;align-items:center}table[data-v-001dab86]{border-collapse:collapse;overflow:hidden;border-radius:var(--border-radius)}table.full-width[data-v-001dab86]{border-radius:0!important;min-width:60%}table.full-width thead[data-v-001dab86]{cursor:pointer}table.full-width thead th div[data-v-001dab86]{display:flex;align-items:center;justify-content:space-between}table.full-width tbody[data-v-001dab86]{border-bottom:1px solid var(--sortable-table-top-divider)}table tr>td[data-v-001dab86]:first-of-type{width:20%}table td[data-v-001dab86],table th[data-v-001dab86]{border:1px solid var(--border);padding:8px 5px;min-width:150px;text-align:left}table th[data-v-001dab86]{background-color:var(--sortable-table-top-divider);border-bottom:1px solid var(--sortable-table-header-bg)}table a[data-v-001dab86]{cursor:pointer}table .os[data-v-001dab86]{display:flex;align-items:center}.logs-container[data-v-001dab86]{list-style:none;margin:0;padding:0;background-color:#fff;border:1px solid var(--body-text);height:300px;overflow-x:hidden;overflow-y:auto}.logs-container li[data-v-001dab86]{font-family:Anonymous Pro,monospace;font-size:12px;margin:0;padding:10px 20px;border-bottom:1px solid #ccc}.logs-container li.log[data-v-001dab86]{color:#000}.logs-container li.warn[data-v-001dab86]{background-color:#fafad2;color:#8b4513}.logs-container li.info[data-v-001dab86]{background-color:azure;color:#00f}.logs-container li.error[data-v-001dab86]{background-color:#ffe4e1;color:red}.logs-container li[data-v-001dab86]:last-child{border-bottom:none}.logs-container li .log-entry-type[data-v-001dab86]{font-weight:700}.resources-count-container .cluster-row[data-v-001dab86]{display:grid;grid-template-columns:repeat(4,1fr) 20px;grid-template-rows:1fr;align-content:center;font-weight:400}.resources-count-container tbody tr[data-v-001dab86],.resources-count-container tbody tr th[data-v-001dab86]{background-color:var(--sortable-table-header-bg)}.resources-count-container tbody tr th[data-v-001dab86]{border-bottom:1px solid var(--sortable-table-top-divider)}.resources-count-container tbody tr[data-v-001dab86]:hover{background-color:var(--sortable-table-top-divider)}",""]),t.exports=e},"749a":function(t,e,o){var n=o("44da");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var a=o("499e").default;a("b5ccc8bc",n,!0,{sourceMap:!1,shadowMode:!1})},f05d:function(t,e,o){"use strict";o("749a")}}]);
//# sourceMappingURL=diagnostic.e3045dd1.js.map