(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f706bf8a"],{2201:function(e,t,r){"use strict";r("5261")},3462:function(e,t,r){"use strict";r.r(t);r("498a");var s=function(){var e=this,t=e._self._c;return e.$fetchState.pending?t("Loading",{attrs:{mode:"relative"}}):t("form",{staticClass:"setup"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col span-6 form-col"},[t("div",[e._v("\n        Â \n      ")]),e._v(" "),t("div",[t("h1",{staticClass:"text-center"},[e._v("\n          "+e._s(e.t("setup.welcome",{product:e.product}))+"\n        ")]),e._v(" "),e.mustChangePassword?[t("p",{directives:[{name:"clean-html",rawName:"v-clean-html",value:e.t(e.isFirstLogin?"setup.setPassword":"setup.newUserSetPassword",{username:e.username},!0),expression:"t(isFirstLogin ? 'setup.setPassword' : 'setup.newUserSetPassword', { username }, true)"}],staticClass:"text-center mb-20 mt-20 setup-title"}),e._v(" "),e.haveCurrent?e._e():t("Password",{staticClass:"mb-20",attrs:{autocomplete:"current-password",type:"password",label:e.t("setup.currentPassword"),required:!0},model:{value:e.current,callback:function(t){e.current="string"===typeof t?t.trim():t},expression:"current"}}),e._v(" "),t("input",{attrs:{type:"hidden",name:"username",autocomplete:"username"},domProps:{value:e.username}}),e._v(" "),t("div",{staticClass:"mb-20"},[t("RadioGroup",{attrs:{"data-testid":"setup-password-mode",name:"password-mode",options:e.passwordOptions},model:{value:e.useRandom,callback:function(t){e.useRandom=t},expression:"useRandom"}})],1),e._v(" "),t("div",{staticClass:"mb-20"},[e.useRandom?t("LabeledInput",{ref:"password",attrs:{type:e.useRandom?"text":"password",disabled:e.useRandom,"data-testid":"setup-password-random","label-key":"setup.newPassword"},scopedSlots:e._u([e.useRandom?{key:"suffix",fn:function(){return[t("div",{staticClass:"addon",staticStyle:{padding:"0 0 0 12px"}},[t("CopyToClipboard",{staticClass:"btn-sm",attrs:{text:e.password}})],1)]},proxy:!0}:null],null,!0),model:{value:e.password,callback:function(t){e.password="string"===typeof t?t.trim():t},expression:"password"}}):t("Password",{ref:"password",attrs:{label:e.t("setup.newPassword"),"data-testid":"setup-password",required:!0},model:{value:e.password,callback:function(t){e.password="string"===typeof t?t.trim():t},expression:"password"}})],1),e._v(" "),t("Password",{directives:[{name:"show",rawName:"v-show",value:!e.useRandom,expression:"!useRandom"}],attrs:{autocomplete:"new-password","data-testid":"setup-password-confirm",label:e.t("setup.confirmPassword"),required:!0},model:{value:e.confirm,callback:function(t){e.confirm="string"===typeof t?t.trim():t},expression:"confirm"}})]:e._e(),e._v(" "),e.isFirstLogin?[e.mcmEnabled?[e.mustChangePassword?t("hr",{staticClass:"mt-20 mb-20"}):e._e(),e._v(" "),t("p",[t("t",{attrs:{k:"setup.serverUrl.tip",raw:!0}})],1),e._v(" "),t("div",{staticClass:"mt-20"},[e.showLocalhostWarning?t("Banner",{attrs:{color:"warning",label:e.t("validation.setting.serverUrl.localhost"),"data-testid":"setup-serverurl-localhost-warning"}}):e._e(),e._v(" "),e._l(e.fvGetPathErrors(["serverUrl"]),(function(e,r){return t("Banner",{key:r,attrs:{color:"error",label:e,"data-testid":"setup-error-banner"}})})),e._v(" "),t("LabeledInput",{attrs:{label:e.t("setup.serverUrl.label"),"data-testid":"setup-server-url",rules:e.fvGetAndReportPathRules("serverUrl"),required:!0},on:{input:e.onServerUrlChange},model:{value:e.serverUrl,callback:function(t){e.serverUrl=t},expression:"serverUrl"}})],2)]:e._e(),e._v(" "),t("div",{staticClass:"checkbox mt-40"},[t("Checkbox",{attrs:{id:"checkbox-telemetry"},scopedSlots:e._u([{key:"label",fn:function(){return[t("t",{attrs:{k:"setup.telemetry",raw:!0,name:e.productName}})]},proxy:!0}],null,!1,1048729250),model:{value:e.telemetry,callback:function(t){e.telemetry=t},expression:"telemetry"}})],1),e._v(" "),t("div",{staticClass:"checkbox pt-10 eula"},[t("Checkbox",{attrs:{id:"checkbox-eula","data-testid":"setup-agreement"},scopedSlots:e._u([{key:"label",fn:function(){return[t("t",{attrs:{k:"setup.eula",raw:!0,name:e.productName}})]},proxy:!0}],null,!1,3395104304),model:{value:e.eula,callback:function(t){e.eula=t},expression:"eula"}})],1)]:e._e(),e._v(" "),t("div",{staticClass:"text-center mt-20",attrs:{id:"submit"}},[t("AsyncButton",{key:"passwordSubmit",attrs:{type:"submit",mode:"continue",disabled:!e.saveEnabled,"data-testid":"setup-submit"},on:{click:e.save}})],1),e._v(" "),t("div",{staticClass:"setup-errors mt-20"},e._l(e.errors,(function(r){return t("h4",{key:r,staticClass:"text-error text-center"},[e._v("\n            "+e._s(r)+"\n          ")])})),0)],2)]),e._v(" "),t("BrandImage",{staticClass:"col span-6 landscape",attrs:{"file-name":"login-landscape.svg"}})],1)])},a=[],n=r("1da1"),o=(r("e260"),r("d3b7"),r("e6cf"),r("3ca3"),r("ddb0"),r("ac1f"),r("5319"),r("a34a")),u=r.n(o),i=(r("96cf"),r("2c94")),c=r("84d3"),l=r("091e"),d=r("67c9"),p=r("fa3b"),v=r("a788"),m=r("f303"),b=r("4de2"),h=r("58ec"),f=r("fa35"),w=r("2f40"),g=r("c5b9"),x=r("55a3"),y=r("4579"),k=r("f441"),_=r("9bc6"),C=r("a4ed"),$=r("2c2d"),P=r("bec1"),R=r("348f"),E=r("92c9"),U=r.n(E),O=r("0279"),L=r("c778"),j=function(e){var t=e.getters["management/byId"](v["F"].SETTING,g["c"].FIRST_LOGIN);return"true"===(null===t||void 0===t?void 0:t.value)},I=function(){var e=Object(n["a"])(u.a.mark((function e(t){var r,s;return u.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.dispatch("auth/getUser");case 2:return s=null===(r=t.getters["auth/v3User"])||void 0===r?void 0:r.mustChangePassword,e.abrupt("return",s);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),S={mixins:[R["a"]],data:function(){return{passwordOptions:[{label:this.t("setup.useRandom"),value:!0},{label:this.t("setup.useManual"),value:!1}],fvFormRuleSets:[{path:"serverUrl",rootObject:this,rules:["required","https","url","trailingForwardSlash"]}],productName:"",vendor:Object(h["d"])(),product:Object(h["c"])(),step:parseInt(this.$route.query.step,10)||1,useRandom:!0,haveCurrent:!1,username:null,isFirstLogin:!1,mustChangePassword:!1,current:null,password:Object(i["r"])(),confirm:null,v3User:null,serverUrl:null,mcmEnabled:null,telemetry:null,eula:!1,principals:null,errors:[]}},middleware:function(e){return Object(n["a"])(u.a.mark((function t(){var r,s,a,n;return u.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.store,s=e.redirect,a=j(r),t.next=4,I(r);case 4:if(n=t.sent,!a){t.next=9;break}return t.abrupt("return");case 9:if(!n){t.next=15;break}if(!r.getters["auth/initialPass"]){t.next=12;break}return t.abrupt("return");case 12:return t.next=14,r.dispatch("auth/logout",null,{root:!0});case 14:return t.abrupt("return",s(302,"/auth/login?".concat(p["t"])));case 15:return t.abrupt("return",s("/"));case 16:case"end":return t.stop()}}),t)})))()},components:{AsyncButton:d["b"],LabeledInput:c["a"],CopyToClipboard:l["a"],Checkbox:b["a"],RadioGroup:f["b"],Password:k["a"],BrandImage:C["a"],Banner:P["a"],Loading:L["a"]},fetch:function(){var e=this;return Object(n["a"])(u.a.mark((function t(){var r,s,a,n,o,i,c,l,d,b,f,w,y,k,_,C,$,P,R;return u.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:o=e.$store.getters["management/byId"](v["F"].SETTING,g["c"].TELEMETRY),i=e.$store.getters["management/byId"](v["F"].SETTING,g["c"].SERVER_URL),c=e.$store.getters["management/byId"](v["F"].SETTING,g["c"].VERSION_RANCHER),l=!0,null!==o&&void 0!==o&&o.value&&"prompt"!==o.value?l="out"!==o.value:null!==c&&void 0!==c&&c.value&&!Object(x["c"])(null===c||void 0===c?void 0:c.value)||(l=!1),t.prev=5,d=e.$store.getters["management/byId"](v["F"].SETTING,g["c"].PL),t.next=14;break;case 9:return t.prev=9,t.t0=t["catch"](5),t.next=13,e.$store.dispatch("rancher/find",{type:v["L"].SETTING,id:g["c"].PL,opt:{url:"/v3/settings/".concat(g["c"].PL)}});case 13:d=t.sent;case 14:return null!==(r=d.value)&&void 0!==r&&r.length&&d.value!==Object(h["d"])()&&Object(h["g"])(d.value),b=d.default,t.next=18,e.$store.dispatch("rancher/findAll",{type:v["L"].PRINCIPAL,opt:{url:"/v3/principals"}});case 18:return f=t.sent,w=Object(m["e"])(f,"me",!0),y=e.$route.query[p["E"]]||e.$store.getters["auth/initialPass"],k=null!==(s=e.$store.getters["auth/v3User"])&&void 0!==s?s:{},t.next=24,e.$store.dispatch("management/find",{type:v["F"].FEATURE,id:"multi-cluster-management",opt:{url:"/v1/".concat(v["F"].FEATURE,"/multi-cluster-management")}});case 24:return _=t.sent,C=(null===_||void 0===_||null===(a=_.spec)||void 0===a?void 0:a.value)||(null===_||void 0===_||null===(n=_.status)||void 0===n?void 0:n.default),$=null!==i&&void 0!==i&&i.value?i.value:window.location.origin,t.next=29,j(e.$store);case 29:return P=t.sent,t.next=32,I(e.$store);case 32:R=t.sent,e.$set(e,"productName",b),e.$set(e,"haveCurrent",!!y),e.$set(e,"username",(null===w||void 0===w?void 0:w.loginName)||"admin"),e.$set(e,"isFirstLogin",P),e.$set(e,"mustChangePassword",R),e.$set(e,"current",y),e.$set(e,"v3User",k),e.$set(e,"serverUrl",$),e.$set(e,"mcmEnabled",C),e.$set(e,"telemetry",l),e.$set(e,"principals",f);case 44:case"end":return t.stop()}}),t,null,[[5,9]])})))()},computed:{saveEnabled:function(){if(!this.eula&&this.isFirstLogin)return!1;if(this.mustChangePassword){if(!this.current)return!1;if(!this.useRandom&&(!this.password||this.password!==this.confirm))return!1}return!(!U()(this.serverUrl)||this.fvGetPathErrors(["serverUrl"]).length>0)},me:function(){var e=Object(m["e"])(this.principals,"me",!0);return e},showLocalhostWarning:function(){return Object(O["c"])(this.serverUrl)}},watch:{useRandom:function(e){var t=this;e?this.password=Object(i["r"])():(this.password="",this.$nextTick((function(){t.$refs.password.focus()})))}},methods:{save:function(e){var t=this;return Object(n["a"])(u.a.mark((function r(){var s,a;return u.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return s=[],r.prev=1,r.next=4,Object(_["applyProducts"])(t.$store,t.$plugin);case 4:return r.next=6,t.$store.dispatch("loadManagement");case 6:if(!t.mustChangePassword){r.next=11;break}return r.next=9,t.$store.dispatch("rancher/request",{url:"/v3/users?action=changepassword",method:"post",data:{currentPassword:t.current,newPassword:t.password}});case 9:r.next=12;break;case 11:s.push(Object(w["e"])(t.$store,g["c"].FIRST_LOGIN,"false"));case 12:return a=t.v3User,a.mustChangePassword=!1,t.$store.dispatch("auth/gotUser",a),t.isFirstLogin&&(s.push(Object(w["e"])(t.$store,g["c"].EULA_AGREED,(new Date).toISOString())),s.push(Object(w["e"])(t.$store,g["c"].TELEMETRY,t.telemetry?"in":"out")),t.mcmEnabled&&t.serverUrl&&s.push(Object(w["e"])(t.$store,g["c"].SERVER_URL,t.serverUrl))),r.next=18,Promise.all(s);case 18:return r.next=20,Object($["b"])((function(){return!j(t.$store)}),"first login to be completed",1e4,1e3,!0);case 20:e(!0),t.done(),r.next=29;break;case 24:r.prev=24,r.t0=r["catch"](1),console.error(r.t0),e(!1),t.errors=Object(y["d"])(r.t0);case 29:case"end":return r.stop()}}),r,null,[[1,24]])})))()},done:function(){this.$router.replace("/")},onServerUrlChange:function(e){this.serverUrl=e.trim()}}},T=S,F=(r("2201"),r("0c7c")),N=Object(F["a"])(T,s,a,!1,null,"2b4c5942",null);t["default"]=N.exports},5261:function(e,t,r){var s=r("9f52");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var a=r("499e").default;a("6c7a1576",s,!0,{sourceMap:!1,shadowMode:!1})},"9f52":function(e,t,r){var s=r("4bad");t=s(!1),t.push([e.i,".principal[data-v-2b4c5942]{display:block;background:var(--box-bg);border:1px solid var(--border);border-radius:3px;margin:10px 0;padding:10px;line-height:40px}.principal img[data-v-2b4c5942]{vertical-align:middle;margin:0 10px}.setup[data-v-2b4c5942]{overflow:hidden}.setup .row .checkbox[data-v-2b4c5942]{margin:auto}.setup .row .span-6[data-v-2b4c5942]{padding:0 60px}.setup .row .landscape[data-v-2b4c5942]{height:100vh;margin:0;-o-object-fit:cover;object-fit:cover;padding:0}.setup .form-col[data-v-2b4c5942]{display:flex;flex-direction:column;overflow-y:auto;position:relative;height:100vh}.setup .form-col>div[data-v-2b4c5942]:first-of-type{flex:3}.setup .form-col>div[data-v-2b4c5942]:nth-of-type(2){flex:9}.setup .setup-title[data-v-2b4c5942] code{font-size:12px;padding:0}.setup .setup-errors[data-v-2b4c5942]{min-height:50px}.setup p[data-v-2b4c5942]{line-height:20px}",""]),e.exports=t}}]);
//# sourceMappingURL=chunk-f706bf8a.9878a051.js.map