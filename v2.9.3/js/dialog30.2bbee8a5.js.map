{"version":3,"sources":["webpack:///./shell/dialog/RotateCertificatesDialog.vue?6e63","webpack:///./shell/dialog/RotateCertificatesDialog.vue","webpack:///shell/dialog/RotateCertificatesDialog.vue","webpack:///./shell/dialog/RotateCertificatesDialog.vue?3061","webpack:///./shell/dialog/RotateCertificatesDialog.vue?c385","webpack:///./shell/dialog/RotateCertificatesDialog.vue?4226","webpack:///./shell/dialog/RotateCertificatesDialog.vue?ba8c"],"names":["content","__esModule","default","module","i","locals","exports","add","render","_vm","this","_c","_self","staticClass","style","attrs","scopedSlots","_u","key","fn","_v","_s","t","proxy","_l","errors","error","value","label","model","rotateAllServices","callback","$$v","expression","class","serviceOptions","selectedService","slot","on","close","rotate","staticRenderFns","components","Select","RadioGroup","Card","AsyncButton","Banner","props","cluster","type","Object","data","computed","isRke2","options","isK3s","push","sort","schema","$store","getters","get","actionParams","services","caCertificates","mounted","methods","$emit","buttonDone","_this","_asyncToGenerator","_regeneratorRuntime","mark","_callee","params","_this$cluster$spec","_this$cluster$spec$rk","_this$cluster$spec$rk2","currentGeneration","wrap","_context","prev","next","spec","rkeConfig","rotateCertificates","generation","set","save","mgmt","doAction","t0","exceptionToErrorsArray","stop","component","___CSS_LOADER_API_IMPORT___"],"mappings":"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","file":"js/dialog30.2bbee8a5.js","sourcesContent":["// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-3!../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-4!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!./RotateCertificatesDialog.vue?vue&type=style&index=0&id=815c1af0&prod&lang=scss&scoped=true&\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"1002865d\", content, true, {\"sourceMap\":false,\"shadowMode\":false});","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('Card',{staticClass:\"prompt-rotate\",style:({'height':'100%'}),attrs:{\"show-highlight-border\":false},scopedSlots:_vm._u([{key:\"title\",fn:function(){return [_c('h3',[_vm._v(_vm._s(_vm.t('cluster.rotateCertificates.modalTitle')))])]},proxy:true},{key:\"body\",fn:function(){return [_vm._l((_vm.errors),function(error,i){return _c('Banner',{key:i,attrs:{\"color\":\"error\",\"label\":error}})}),_vm._v(\" \"),_c('div',{staticClass:\"options\"},[_c('RadioGroup',{attrs:{\"name\":\"service-mode\",\"options\":[\n          {\n            value: true,\n            label:_vm.t('cluster.rotateCertificates.allServices')\n          },\n          {\n            value: false,\n            label:_vm.t('cluster.rotateCertificates.selectService')\n          }\n        ]},model:{value:(_vm.rotateAllServices),callback:function ($$v) {_vm.rotateAllServices=$$v},expression:\"rotateAllServices\"}}),_vm._v(\" \"),_c('Select',{staticClass:\"service-select\",class:{'invisible': _vm.rotateAllServices},attrs:{\"options\":_vm.serviceOptions},model:{value:(_vm.selectedService),callback:function ($$v) {_vm.selectedService=$$v},expression:\"selectedService\"}})],1)]},proxy:true}])},[_vm._v(\" \"),_vm._v(\" \"),_c('div',{staticClass:\"buttons\",attrs:{\"slot\":\"actions\"},slot:\"actions\"},[_c('button',{staticClass:\"btn role-secondary mr-20\",on:{\"click\":_vm.close}},[_vm._v(\"\\n      \"+_vm._s(_vm.t('generic.cancel'))+\"\\n    \")]),_vm._v(\" \"),_c('AsyncButton',{attrs:{\"mode\":\"rotate\",\"disabled\":!_vm.rotateAllServices && !_vm.selectedService},on:{\"click\":_vm.rotate}})],1)])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<script>\nimport { Card } from '@components/Card';\nimport AsyncButton from '@shell/components/AsyncButton';\nimport { Banner } from '@components/Banner';\n\nimport { RadioGroup } from '@components/Form/Radio';\nimport Select from '@shell/components/form/Select';\n\nimport { get, set } from '@shell/utils/object';\nimport { exceptionToErrorsArray } from '@shell/utils/error';\n\nexport default {\n  components: {\n    Select,\n    RadioGroup,\n    Card,\n    AsyncButton,\n    Banner\n  },\n\n  props: {\n    cluster: {\n      type:    Object,\n      default: () => {\n        return {};\n      }\n    }\n  },\n\n  data() {\n    return {\n      selectedService:   '',\n      rotateAllServices: true,\n      errors:            []\n    };\n  },\n\n  computed: {\n    serviceOptions() {\n      if (this.cluster.isRke2) {\n        const options = [\n          'admin',\n          'api-server',\n          'controller-manager',\n          'scheduler',\n          'cloud-controller',\n          'etcd',\n          'auth-proxy',\n          'kubelet',\n          'kube-proxy'\n        ];\n\n        if ( this.cluster.isK3s ) {\n          options.push('k3s-controller', 'k3s-server');\n        } else {\n          options.push('rke2-controller', 'rke2-server');\n        }\n\n        return options.sort();\n      }\n      // For RKE1 clusters, Norman provides the list of service options:\n      // type RotateCertificateInput struct {\n      //   CACertificates bool     `json:\"caCertificates,omitempty\"`\n      //   Services       []string `json:\"services,omitempty\" norman:\"type=enum,options=etcd|kubelet|kube-apiserver|kube-proxy|kube-scheduler|kube-controller-manager\"`\n      // }\n      const schema = this.$store.getters['rancher/schemaFor']('rotatecertificateinput');\n\n      return get(schema, 'resourceFields.services.options') || [];\n    },\n\n    actionParams() {\n      if (this.rotateAllServices) {\n        return {\n          // To rotate all services, RKE1 clusters need services\n          // to be null, while RKE2 requires an empty array.\n          services:       this.cluster.isRke2 ? [] : null,\n          caCertificates: false,\n        };\n      } else {\n        return {\n          services:       this.selectedService,\n          caCertificates: false,\n        };\n      }\n    }\n  },\n\n  mounted() {\n    this.selectedService = this.serviceOptions[0] || '';\n  },\n\n  methods: {\n    close() {\n      this.$emit('close');\n    },\n\n    async rotate(buttonDone) {\n      const params = this.actionParams;\n\n      try {\n        if (this.cluster.isRke2) {\n        // The Steve API doesn't support actions, so for RKE2 cluster cert rotation, we patch the cluster.\n          const currentGeneration = this.cluster.spec?.rkeConfig?.rotateCertificates?.generation || 0;\n\n          set(this.cluster, 'spec.rkeConfig.rotateCertificates', {\n            generation: currentGeneration + 1,\n            services:   (this.selectedService && !this.rotateAllServices) ? [this.selectedService] : []\n          });\n\n          await this.cluster.save();\n        } else {\n          await this.cluster.mgmt.doAction('rotateCertificates', params);\n        }\n        buttonDone(true);\n        this.close();\n      } catch (err) {\n        this.errors = exceptionToErrorsArray(err);\n        buttonDone(false);\n      }\n    }\n  }\n};\n</script>\n\n<template>\n  <Card\n    class=\"prompt-rotate\"\n    :show-highlight-border=\"false\"\n    :style=\"{'height':'100%'}\"\n  >\n    <template #title>\n      <h3>{{ t('cluster.rotateCertificates.modalTitle') }}</h3>\n    </template>\n    <template #body>\n      <Banner\n        v-for=\"(error, i) in errors\"\n        :key=\"i\"\n        class=\"\"\n        color=\"error\"\n        :label=\"error\"\n      />\n      <div class=\"options\">\n        <RadioGroup\n          v-model=\"rotateAllServices\"\n          name=\"service-mode\"\n          :options=\"[\n            {\n              value: true,\n              label:t('cluster.rotateCertificates.allServices')\n            },\n            {\n              value: false,\n              label:t('cluster.rotateCertificates.selectService')\n            }\n          ]\"\n        />\n        <Select\n          v-model=\"selectedService\"\n          :options=\"serviceOptions\"\n          class=\"service-select\"\n          :class=\"{'invisible': rotateAllServices}\"\n        />\n      </div>\n    </template>\n    <div\n      slot=\"actions\"\n      class=\"buttons\"\n    >\n      <button\n        class=\"btn role-secondary mr-20\"\n        @click=\"close\"\n      >\n        {{ t('generic.cancel') }}\n      </button>\n      <AsyncButton\n        mode=\"rotate\"\n        :disabled=\"!rotateAllServices && !selectedService\"\n        @click=\"rotate\"\n      />\n    </div>\n  </Card>\n</template>\n\n<style lang='scss' scoped>\n  .prompt-rotate {\n    margin: 0;\n  }\n  .buttons {\n    display: flex;\n    justify-content: flex-end;\n    width: 100%;\n  }\n  .options {\n    display: flex;\n    flex-direction: column;\n\n    .service-select {\n      margin-left: 20px;\n      margin-top: 10px;\n      width: fit-content;\n      min-width: 260px;\n    }\n  }\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--16-0!../../node_modules/babel-loader/lib/index.js??ref--16-1!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!./RotateCertificatesDialog.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--16-0!../../node_modules/babel-loader/lib/index.js??ref--16-1!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!./RotateCertificatesDialog.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./RotateCertificatesDialog.vue?vue&type=template&id=815c1af0&scoped=true&\"\nimport script from \"./RotateCertificatesDialog.vue?vue&type=script&lang=js&\"\nexport * from \"./RotateCertificatesDialog.vue?vue&type=script&lang=js&\"\nimport style0 from \"./RotateCertificatesDialog.vue?vue&type=style&index=0&id=815c1af0&prod&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"815c1af0\",\n  null\n  \n)\n\nexport default component.exports","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../node_modules/@vue/cli-service/node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".prompt-rotate[data-v-815c1af0]{margin:0}.buttons[data-v-815c1af0]{display:flex;justify-content:flex-end;width:100%}.options[data-v-815c1af0]{display:flex;flex-direction:column}.options .service-select[data-v-815c1af0]{margin-left:20px;margin-top:10px;width:-moz-fit-content;width:fit-content;min-width:260px}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","export * from \"-!../../node_modules/vue-style-loader/index.js??ref--9-oneOf-1-0!../../node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-3!../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-4!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!./RotateCertificatesDialog.vue?vue&type=style&index=0&id=815c1af0&prod&lang=scss&scoped=true&\""],"sourceRoot":""}